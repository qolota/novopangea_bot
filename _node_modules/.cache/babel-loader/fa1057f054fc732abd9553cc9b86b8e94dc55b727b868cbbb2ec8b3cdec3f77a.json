{"ast":null,"code":"\"use strict\";\n\nvar _toConsumableArray = require(\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _createForOfIteratorHelper = require(\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _regeneratorRuntime = require(\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _classCallCheck = require(\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.defaultTxVerifier = exports.WaxJS = void 0;\nvar eosjs_1 = require(\"eosjs\");\nvar eosjs_ecc_migration_1 = require(\"eosjs/dist/eosjs-ecc-migration\");\nvar helpers_1 = require(\"./helpers\");\nvar version_1 = require(\"./version\");\nvar WaxSigningApi_1 = require(\"./WaxSigningApi\");\nvar PROOF_WAX = 1;\nvar PROOF_USER = 2;\nvar WaxJS = /*#__PURE__*/function () {\n  function WaxJS(_ref) {\n    var _this = this;\n    var rpcEndpoint = _ref.rpcEndpoint,\n      _ref$tryAutoLogin = _ref.tryAutoLogin,\n      tryAutoLogin = _ref$tryAutoLogin === void 0 ? true : _ref$tryAutoLogin,\n      userAccount = _ref.userAccount,\n      pubKeys = _ref.pubKeys,\n      apiSigner = _ref.apiSigner,\n      _ref$waxSigningURL = _ref.waxSigningURL,\n      waxSigningURL = _ref$waxSigningURL === void 0 ? \"https://www.mycloudwallet.com\" : _ref$waxSigningURL,\n      _ref$waxAutoSigningUR = _ref.waxAutoSigningURL,\n      waxAutoSigningURL = _ref$waxAutoSigningUR === void 0 ? \"https://idm-api.mycloudwallet.com/v1/accounts/auto-accept/\" : _ref$waxAutoSigningUR,\n      _ref$eosApiArgs = _ref.eosApiArgs,\n      eosApiArgs = _ref$eosApiArgs === void 0 ? {} : _ref$eosApiArgs,\n      _ref$freeBandwidth = _ref.freeBandwidth,\n      freeBandwidth = _ref$freeBandwidth === void 0 ? true : _ref$freeBandwidth,\n      _ref$feeFallback = _ref.feeFallback,\n      feeFallback = _ref$feeFallback === void 0 ? true : _ref$feeFallback,\n      _ref$verifyTx = _ref.verifyTx,\n      verifyTx = _ref$verifyTx === void 0 ? defaultTxVerifier : _ref$verifyTx,\n      _ref$metricURL = _ref.metricURL,\n      metricURL = _ref$metricURL === void 0 ? \"\" : _ref$metricURL,\n      _ref$returnTempAccoun = _ref.returnTempAccounts,\n      returnTempAccounts = _ref$returnTempAccoun === void 0 ? false : _ref$returnTempAccoun;\n    _classCallCheck(this, WaxJS);\n    this.rpc = new eosjs_1.JsonRpc(rpcEndpoint);\n    this.signingApi = new WaxSigningApi_1.WaxSigningApi(waxSigningURL, waxAutoSigningURL, this.rpc, metricURL, returnTempAccounts);\n    this.waxSigningURL = waxSigningURL;\n    this.waxAutoSigningURL = waxAutoSigningURL;\n    this.apiSigner = apiSigner;\n    this.eosApiArgs = eosApiArgs;\n    this.freeBandwidth = freeBandwidth;\n    this.feeFallback = feeFallback;\n    this.metricURL = metricURL;\n    this.verifyTx = verifyTx;\n    this.returnTempAccounts = returnTempAccounts;\n    if (userAccount && Array.isArray(pubKeys)) {\n      // login from constructor\n      this.receiveLogin({\n        account: userAccount,\n        keys: pubKeys\n      });\n    } else {\n      // try to auto-login via endpoint\n      if (tryAutoLogin) {\n        this.signingApi.tryAutologin().then(function (response) {\n          return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n            return _regeneratorRuntime().wrap(function _callee$(_context) {\n              while (1) switch (_context.prev = _context.next) {\n                case 0:\n                  if (!response) {\n                    _context.next = 6;\n                    break;\n                  }\n                  _context.t0 = this;\n                  _context.next = 4;\n                  return this.signingApi.login();\n                case 4:\n                  _context.t1 = _context.sent;\n                  _context.t0.receiveLogin.call(_context.t0, _context.t1);\n                case 6:\n                case \"end\":\n                  return _context.stop();\n              }\n            }, _callee, this);\n          }));\n        });\n      }\n    }\n  }\n  _createClass(WaxJS, [{\n    key: \"userAccount\",\n    get: function get() {\n      return this.user && this.user.account;\n    }\n  }, {\n    key: \"pubKeys\",\n    get: function get() {\n      return this.user && this.user.keys;\n    }\n  }, {\n    key: \"isTemp\",\n    get: function get() {\n      return this.user && this.user.isTemp;\n    }\n  }, {\n    key: \"createInfo\",\n    get: function get() {\n      return this.user && this.user.createData;\n    }\n  }, {\n    key: \"avatar\",\n    get: function get() {\n      var _a;\n      return (_a = this.user) === null || _a === void 0 ? void 0 : _a.avatarUrl;\n    }\n  }, {\n    key: \"trustScore\",\n    get: function get() {\n      var _a;\n      return (_a = this.user) === null || _a === void 0 ? void 0 : _a.trustScore;\n    }\n  }, {\n    key: \"trustScoreProvider\",\n    get: function get() {\n      return \"https://chainchamps.com\";\n    }\n  }, {\n    key: \"version\",\n    get: function get() {\n      return version_1.version;\n    }\n  }, {\n    key: \"proofVerified\",\n    get: function get() {\n      var _a;\n      return (_a = this.user) === null || _a === void 0 ? void 0 : _a.isProofVerified;\n    }\n  }, {\n    key: \"login\",\n    value: function login(nonce) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (this.user) {\n                _context2.next = 6;\n                break;\n              }\n              _context2.t0 = this;\n              _context2.next = 4;\n              return this.signingApi.login(nonce);\n            case 4:\n              _context2.t1 = _context2.sent;\n              _context2.t0.receiveLogin.call(_context2.t0, _context2.t1);\n            case 6:\n              return _context2.abrupt(\"return\", this.user.account);\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n    }\n  }, {\n    key: \"isAutoLoginAvailable\",\n    value: function isAutoLoginAvailable() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!this.user) {\n                _context3.next = 4;\n                break;\n              }\n              return _context3.abrupt(\"return\", true);\n            case 4:\n              _context3.next = 6;\n              return this.signingApi.tryAutologin();\n            case 6:\n              if (!_context3.sent) {\n                _context3.next = 13;\n                break;\n              }\n              _context3.t0 = this;\n              _context3.next = 10;\n              return this.signingApi.login();\n            case 10:\n              _context3.t1 = _context3.sent;\n              _context3.t0.receiveLogin.call(_context3.t0, _context3.t1);\n              return _context3.abrupt(\"return\", true);\n            case 13:\n              return _context3.abrupt(\"return\", false);\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n    }\n  }, {\n    key: \"logout\",\n    value: function logout() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              this.user = null;\n              this.api = null;\n              if (this.signingApi) {\n                this.signingApi.logout();\n              }\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this);\n      }));\n    }\n  }, {\n    key: \"userAccountProof\",\n    value: function userAccountProof(nonce, description) {\n      var verify = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var data, message, _iterator, _step, key;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (this.user) {\n                _context5.next = 2;\n                break;\n              }\n              throw new Error(\"User is not logged in\");\n            case 2:\n              _context5.next = 4;\n              return this.signingApi.proofWindow(nonce, PROOF_USER, description);\n            case 4:\n              data = _context5.sent;\n              message = nonce;\n              if (verify) {\n                _context5.next = 8;\n                break;\n              }\n              return _context5.abrupt(\"return\", Object.assign(Object.assign({}, data), {\n                message: message\n              }));\n            case 8:\n              _iterator = _createForOfIteratorHelper(this.pubKeys);\n              _context5.prev = 9;\n              _iterator.s();\n            case 11:\n              if ((_step = _iterator.n()).done) {\n                _context5.next = 17;\n                break;\n              }\n              key = _step.value;\n              if (!eosjs_ecc_migration_1.ecc.verify(data.signature, message, key)) {\n                _context5.next = 15;\n                break;\n              }\n              return _context5.abrupt(\"return\", true);\n            case 15:\n              _context5.next = 11;\n              break;\n            case 17:\n              _context5.next = 22;\n              break;\n            case 19:\n              _context5.prev = 19;\n              _context5.t0 = _context5[\"catch\"](9);\n              _iterator.e(_context5.t0);\n            case 22:\n              _context5.prev = 22;\n              _iterator.f();\n              return _context5.finish(22);\n            case 25:\n              return _context5.abrupt(\"return\", false);\n            case 26:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this, [[9, 19, 22, 25]]);\n      }));\n    }\n  }, {\n    key: \"waxProof\",\n    value: function waxProof(nonce) {\n      var verify = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var data, message;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              if (this.user) {\n                _context6.next = 2;\n                break;\n              }\n              throw new Error(\"User is not logged in\");\n            case 2:\n              _context6.next = 4;\n              return this.signingApi.proofWindow(nonce, PROOF_WAX, null);\n            case 4:\n              data = _context6.sent;\n              message = \"cloudwallet-verification-\".concat(data.referer, \"-\").concat(nonce, \"-\").concat(data.accountName);\n              if (verify) {\n                _context6.next = 8;\n                break;\n              }\n              return _context6.abrupt(\"return\", Object.assign(Object.assign({}, data), {\n                message: message\n              }));\n            case 8:\n              _context6.t0 = eosjs_ecc_migration_1.ecc;\n              _context6.t1 = data.signature;\n              _context6.t2 = message;\n              _context6.next = 13;\n              return (0, helpers_1.getProofWaxRequiredKeys)(this.rpc.endpoint);\n            case 13:\n              _context6.t3 = _context6.sent;\n              return _context6.abrupt(\"return\", _context6.t0.verify.call(_context6.t0, _context6.t1, _context6.t2, _context6.t3));\n            case 15:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n    }\n  }, {\n    key: \"receiveLogin\",\n    value: function receiveLogin(data) {\n      var _this2 = this;\n      this.user = data;\n      var signatureProvider = {\n        getAvailableKeys: function getAvailableKeys() {\n          return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n            return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n              while (1) switch (_context7.prev = _context7.next) {\n                case 0:\n                  _context7.t0 = [];\n                  _context7.t1 = _toConsumableArray(this.user.keys);\n                  _context7.t2 = _toConsumableArray;\n                  _context7.t4 = this.apiSigner;\n                  if (!_context7.t4) {\n                    _context7.next = 8;\n                    break;\n                  }\n                  _context7.next = 7;\n                  return this.apiSigner.getAvailableKeys();\n                case 7:\n                  _context7.t4 = _context7.sent;\n                case 8:\n                  _context7.t3 = _context7.t4;\n                  if (_context7.t3) {\n                    _context7.next = 11;\n                    break;\n                  }\n                  _context7.t3 = [];\n                case 11:\n                  _context7.t5 = _context7.t3;\n                  _context7.t6 = (0, _context7.t2)(_context7.t5);\n                  return _context7.abrupt(\"return\", _context7.t0.concat.call(_context7.t0, _context7.t1, _context7.t6));\n                case 14:\n                case \"end\":\n                  return _context7.stop();\n              }\n            }, _callee7, this);\n          }));\n        },\n        sign: function sign(sigArgs) {\n          return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n            var originalTx, _yield$this$signingAp, serializedTransaction, signatures, augmentedTx;\n            return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n              while (1) switch (_context8.prev = _context8.next) {\n                case 0:\n                  _context8.next = 2;\n                  return this.api.deserializeTransactionWithActions(sigArgs.serializedTransaction);\n                case 2:\n                  originalTx = _context8.sent;\n                  _context8.next = 5;\n                  return this.signingApi.signing(originalTx, sigArgs.serializedTransaction, !this.freeBandwidth, this.feeFallback);\n                case 5:\n                  _yield$this$signingAp = _context8.sent;\n                  serializedTransaction = _yield$this$signingAp.serializedTransaction;\n                  signatures = _yield$this$signingAp.signatures;\n                  _context8.next = 10;\n                  return this.api.deserializeTransactionWithActions(serializedTransaction);\n                case 10:\n                  augmentedTx = _context8.sent;\n                  this.verifyTx(this.user, originalTx, augmentedTx);\n                  sigArgs.serializedTransaction = serializedTransaction;\n                  _context8.t0 = serializedTransaction;\n                  _context8.t1 = [];\n                  _context8.t2 = _toConsumableArray(signatures);\n                  _context8.t3 = _toConsumableArray;\n                  _context8.t5 = this.apiSigner;\n                  if (!_context8.t5) {\n                    _context8.next = 22;\n                    break;\n                  }\n                  _context8.next = 21;\n                  return this.apiSigner.sign(sigArgs);\n                case 21:\n                  _context8.t5 = _context8.sent.signatures;\n                case 22:\n                  _context8.t4 = _context8.t5;\n                  if (_context8.t4) {\n                    _context8.next = 25;\n                    break;\n                  }\n                  _context8.t4 = [];\n                case 25:\n                  _context8.t6 = _context8.t4;\n                  _context8.t7 = (0, _context8.t3)(_context8.t6);\n                  _context8.t8 = _context8.t1.concat.call(_context8.t1, _context8.t2, _context8.t7);\n                  return _context8.abrupt(\"return\", {\n                    serializedTransaction: _context8.t0,\n                    signatures: _context8.t8\n                  });\n                case 29:\n                case \"end\":\n                  return _context8.stop();\n              }\n            }, _callee8, this);\n          }));\n        }\n      };\n      this.api = new eosjs_1.Api(Object.assign(Object.assign({}, this.eosApiArgs), {\n        rpc: this.rpc,\n        signatureProvider: signatureProvider\n      }));\n      var transact = this.api.transact.bind(this.api);\n      // We monkeypatch the transact method to overcome timeouts\n      // firing the pop-up which some browsers enforce, such as Safari.\n      // By pre-creating the pop-up window we will interact with,\n      // we ensure that it is not going to be rejected due to a delayed\n      // pop up that would otherwise occur post transaction creation\n      this.api.transact = function (transaction, namedParams) {\n        return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n          return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n            while (1) switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return this.signingApi.prepareTransaction(transaction);\n              case 2:\n                _context9.next = 4;\n                return transact(transaction, namedParams);\n              case 4:\n                return _context9.abrupt(\"return\", _context9.sent);\n              case 5:\n              case \"end\":\n                return _context9.stop();\n            }\n          }, _callee9, this);\n        }));\n      };\n    }\n  }]);\n  return WaxJS;\n}();\nexports.WaxJS = WaxJS;\nfunction defaultTxVerifier(user, originalTx, augmentedTx) {\n  var originalActions = originalTx.actions;\n  var augmentedActions = augmentedTx.actions;\n  if (JSON.stringify(originalActions) !== JSON.stringify(augmentedActions.slice(augmentedActions.length - originalActions.length))) {\n    throw new Error(\"Augmented transaction actions has modified actions from the original.\\nOriginal: \".concat(JSON.stringify(originalActions, undefined, 2), \"\\nAugmented: \").concat(JSON.stringify(augmentedActions, undefined, 2)));\n  }\n  var _iterator2 = _createForOfIteratorHelper(augmentedActions.slice(0, augmentedActions.length - originalActions.length)),\n    _step2;\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var extraAction = _step2.value;\n      var userAuthedAction = extraAction.authorization.find(function (auth) {\n        return auth.actor === user.account;\n      });\n      if (userAuthedAction) {\n        if (extraAction.account === \"eosio.token\" && extraAction.name === \"transfer\") {\n          var noopAction = augmentedActions[0];\n          if (extraAction.data.to === \"txfee.wax\" && extraAction.data.memo.startsWith(\"WAX fee for \") && JSON.stringify(noopAction) === JSON.stringify({\n            account: \"boost.wax\",\n            name: \"noop\",\n            authorization: [{\n              actor: \"boost.wax\",\n              permission: \"paybw\"\n            }],\n            data: {}\n          })) {\n            continue;\n          }\n        }\n        if (extraAction.account === \"eosio\" && extraAction.name === \"buyrambytes\") {\n          if (extraAction.data.receiver === user.account) {\n            continue;\n          }\n        }\n        throw new Error(\"Augmented transaction actions has an extra action from the original authorizing the user.\\nOriginal: \".concat(JSON.stringify(originalActions, undefined, 2), \"\\nAugmented: \").concat(JSON.stringify(augmentedActions, undefined, 2)));\n      }\n    }\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n}\nexports.defaultTxVerifier = defaultTxVerifier;","map":{"version":3,"names":["_toConsumableArray","require","default","_createForOfIteratorHelper","_regeneratorRuntime","_classCallCheck","_createClass","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","defaultTxVerifier","WaxJS","eosjs_1","eosjs_ecc_migration_1","helpers_1","version_1","WaxSigningApi_1","PROOF_WAX","PROOF_USER","_ref","_this","rpcEndpoint","_ref$tryAutoLogin","tryAutoLogin","userAccount","pubKeys","apiSigner","_ref$waxSigningURL","waxSigningURL","_ref$waxAutoSigningUR","waxAutoSigningURL","_ref$eosApiArgs","eosApiArgs","_ref$freeBandwidth","freeBandwidth","_ref$feeFallback","feeFallback","_ref$verifyTx","verifyTx","_ref$metricURL","metricURL","_ref$returnTempAccoun","returnTempAccounts","rpc","JsonRpc","signingApi","WaxSigningApi","Array","isArray","receiveLogin","account","keys","tryAutologin","response","mark","_callee","wrap","_callee$","_context","prev","t0","login","t1","sent","call","stop","key","get","user","isTemp","createData","_a","avatarUrl","trustScore","version","isProofVerified","nonce","_callee2","_callee2$","_context2","abrupt","isAutoLoginAvailable","_callee3","_callee3$","_context3","logout","_callee4","_callee4$","_context4","api","userAccountProof","description","verify","arguments","length","undefined","_callee5","data","message","_iterator","_step","_callee5$","_context5","Error","proofWindow","assign","s","n","ecc","signature","f","finish","waxProof","_callee6","_callee6$","_context6","concat","referer","accountName","t2","getProofWaxRequiredKeys","endpoint","t3","_this2","signatureProvider","getAvailableKeys","_callee7","_callee7$","_context7","t4","t5","t6","sign","sigArgs","_callee8","originalTx","_yield$this$signingAp","serializedTransaction","signatures","augmentedTx","_callee8$","_context8","deserializeTransactionWithActions","signing","t7","t8","Api","transact","bind","transaction","namedParams","_callee9","_callee9$","_context9","prepareTransaction","originalActions","actions","augmentedActions","JSON","stringify","slice","_iterator2","_step2","extraAction","userAuthedAction","authorization","find","auth","actor","name","noopAction","to","memo","startsWith","permission","receiver","err"],"sources":["/Users/germangurov/projects/wax_bot/node_modules/@waxio/waxjs/dist/index.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.defaultTxVerifier = exports.WaxJS = void 0;\nconst eosjs_1 = require(\"eosjs\");\nconst eosjs_ecc_migration_1 = require(\"eosjs/dist/eosjs-ecc-migration\");\nconst helpers_1 = require(\"./helpers\");\nconst version_1 = require(\"./version\");\nconst WaxSigningApi_1 = require(\"./WaxSigningApi\");\nconst PROOF_WAX = 1;\nconst PROOF_USER = 2;\nclass WaxJS {\n    get userAccount() {\n        return this.user && this.user.account;\n    }\n    get pubKeys() {\n        return this.user && this.user.keys;\n    }\n    get isTemp() {\n        return this.user && this.user.isTemp;\n    }\n    get createInfo() {\n        return this.user && this.user.createData;\n    }\n    get avatar() {\n        var _a;\n        return (_a = this.user) === null || _a === void 0 ? void 0 : _a.avatarUrl;\n    }\n    get trustScore() {\n        var _a;\n        return (_a = this.user) === null || _a === void 0 ? void 0 : _a.trustScore;\n    }\n    get trustScoreProvider() {\n        return \"https://chainchamps.com\";\n    }\n    get version() {\n        return version_1.version;\n    }\n    get proofVerified() {\n        var _a;\n        return (_a = this.user) === null || _a === void 0 ? void 0 : _a.isProofVerified;\n    }\n    constructor({ rpcEndpoint, tryAutoLogin = true, userAccount, pubKeys, apiSigner, waxSigningURL = \"https://www.mycloudwallet.com\", waxAutoSigningURL = \"https://idm-api.mycloudwallet.com/v1/accounts/auto-accept/\", eosApiArgs = {}, freeBandwidth = true, feeFallback = true, verifyTx = defaultTxVerifier, metricURL = \"\", returnTempAccounts = false, }) {\n        this.rpc = new eosjs_1.JsonRpc(rpcEndpoint);\n        this.signingApi = new WaxSigningApi_1.WaxSigningApi(waxSigningURL, waxAutoSigningURL, this.rpc, metricURL, returnTempAccounts);\n        this.waxSigningURL = waxSigningURL;\n        this.waxAutoSigningURL = waxAutoSigningURL;\n        this.apiSigner = apiSigner;\n        this.eosApiArgs = eosApiArgs;\n        this.freeBandwidth = freeBandwidth;\n        this.feeFallback = feeFallback;\n        this.metricURL = metricURL;\n        this.verifyTx = verifyTx;\n        this.returnTempAccounts = returnTempAccounts;\n        if (userAccount && Array.isArray(pubKeys)) {\n            // login from constructor\n            this.receiveLogin({ account: userAccount, keys: pubKeys });\n        }\n        else {\n            // try to auto-login via endpoint\n            if (tryAutoLogin) {\n                this.signingApi.tryAutologin().then((response) => __awaiter(this, void 0, void 0, function* () {\n                    if (response) {\n                        this.receiveLogin(yield this.signingApi.login());\n                    }\n                }));\n            }\n        }\n    }\n    login(nonce) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.user) {\n                this.receiveLogin(yield this.signingApi.login(nonce));\n            }\n            return this.user.account;\n        });\n    }\n    isAutoLoginAvailable() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.user) {\n                return true;\n            }\n            else if (yield this.signingApi.tryAutologin()) {\n                this.receiveLogin(yield this.signingApi.login());\n                return true;\n            }\n            return false;\n        });\n    }\n    logout() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.user = null;\n            this.api = null;\n            if (this.signingApi) {\n                this.signingApi.logout();\n            }\n        });\n    }\n    userAccountProof(nonce, description, verify = true) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.user) {\n                throw new Error(\"User is not logged in\");\n            }\n            const data = yield this.signingApi.proofWindow(nonce, PROOF_USER, description);\n            const message = nonce;\n            if (!verify) {\n                return Object.assign(Object.assign({}, data), { message });\n            }\n            for (const key of this.pubKeys) {\n                if (eosjs_ecc_migration_1.ecc.verify(data.signature, message, key)) {\n                    return true;\n                }\n            }\n            return false;\n        });\n    }\n    waxProof(nonce, verify = true) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.user) {\n                throw new Error(\"User is not logged in\");\n            }\n            const data = yield this.signingApi.proofWindow(nonce, PROOF_WAX, null);\n            const message = `cloudwallet-verification-${data.referer}-${nonce}-${data.accountName}`;\n            if (!verify) {\n                return Object.assign(Object.assign({}, data), { message });\n            }\n            return eosjs_ecc_migration_1.ecc.verify(data.signature, message, yield (0, helpers_1.getProofWaxRequiredKeys)(this.rpc.endpoint));\n        });\n    }\n    receiveLogin(data) {\n        this.user = data;\n        const signatureProvider = {\n            getAvailableKeys: () => __awaiter(this, void 0, void 0, function* () {\n                return [\n                    ...this.user.keys,\n                    ...((this.apiSigner && (yield this.apiSigner.getAvailableKeys())) ||\n                        []),\n                ];\n            }),\n            sign: (sigArgs) => __awaiter(this, void 0, void 0, function* () {\n                const originalTx = yield this.api.deserializeTransactionWithActions(sigArgs.serializedTransaction);\n                const { serializedTransaction, signatures } = yield this.signingApi.signing(originalTx, sigArgs.serializedTransaction, !this.freeBandwidth, this.feeFallback);\n                const augmentedTx = yield this.api.deserializeTransactionWithActions(serializedTransaction);\n                this.verifyTx(this.user, originalTx, augmentedTx);\n                sigArgs.serializedTransaction = serializedTransaction;\n                return {\n                    serializedTransaction,\n                    signatures: [\n                        ...signatures,\n                        ...((this.apiSigner &&\n                            (yield this.apiSigner.sign(sigArgs)).signatures) ||\n                            []),\n                    ],\n                };\n            }),\n        };\n        this.api = new eosjs_1.Api(Object.assign(Object.assign({}, this.eosApiArgs), { rpc: this.rpc, signatureProvider }));\n        const transact = this.api.transact.bind(this.api);\n        // We monkeypatch the transact method to overcome timeouts\n        // firing the pop-up which some browsers enforce, such as Safari.\n        // By pre-creating the pop-up window we will interact with,\n        // we ensure that it is not going to be rejected due to a delayed\n        // pop up that would otherwise occur post transaction creation\n        this.api.transact = (transaction, namedParams) => __awaiter(this, void 0, void 0, function* () {\n            yield this.signingApi.prepareTransaction(transaction);\n            return yield transact(transaction, namedParams);\n        });\n    }\n}\nexports.WaxJS = WaxJS;\nfunction defaultTxVerifier(user, originalTx, augmentedTx) {\n    const { actions: originalActions } = originalTx;\n    const { actions: augmentedActions } = augmentedTx;\n    if (JSON.stringify(originalActions) !==\n        JSON.stringify(augmentedActions.slice(augmentedActions.length - originalActions.length))) {\n        throw new Error(`Augmented transaction actions has modified actions from the original.\\nOriginal: ${JSON.stringify(originalActions, undefined, 2)}\\nAugmented: ${JSON.stringify(augmentedActions, undefined, 2)}`);\n    }\n    for (const extraAction of augmentedActions.slice(0, augmentedActions.length - originalActions.length)) {\n        const userAuthedAction = extraAction.authorization.find((auth) => {\n            return auth.actor === user.account;\n        });\n        if (userAuthedAction) {\n            if (extraAction.account === \"eosio.token\" &&\n                extraAction.name === \"transfer\") {\n                const noopAction = augmentedActions[0];\n                if (extraAction.data.to === \"txfee.wax\" &&\n                    extraAction.data.memo.startsWith(\"WAX fee for \") &&\n                    JSON.stringify(noopAction) ===\n                        JSON.stringify({\n                            account: \"boost.wax\",\n                            name: \"noop\",\n                            authorization: [\n                                {\n                                    actor: \"boost.wax\",\n                                    permission: \"paybw\",\n                                },\n                            ],\n                            data: {},\n                        })) {\n                    continue;\n                }\n            }\n            if (extraAction.account === \"eosio\" &&\n                extraAction.name === \"buyrambytes\") {\n                if (extraAction.data.receiver === user.account) {\n                    continue;\n                }\n            }\n            throw new Error(`Augmented transaction actions has an extra action from the original authorizing the user.\\nOriginal: ${JSON.stringify(originalActions, undefined, 2)}\\nAugmented: ${JSON.stringify(augmentedActions, undefined, 2)}`);\n        }\n    }\n}\nexports.defaultTxVerifier = defaultTxVerifier;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}