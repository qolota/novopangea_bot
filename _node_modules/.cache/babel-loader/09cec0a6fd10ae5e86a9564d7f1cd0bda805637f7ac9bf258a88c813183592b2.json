{"ast":null,"code":"import _toConsumableArray from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _=require('lodash');var fetchWaxData=require('./fetchWaxData');var DEFAULT_LIMIT=1000;var START_ID=1;var fetchAllWaxData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref){var params,_ref$customProcessor,customProcessor,limit,nextId,rows,nextRows,processedNextRows,rowIndex,nextRow,processedNextRow,lastRow;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:params=_ref.params,_ref$customProcessor=_ref.customProcessor,customProcessor=_ref$customProcessor===void 0?/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref3){var row;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:row=_ref3.row;return _context.abrupt(\"return\",row);case 2:case\"end\":return _context.stop();}},_callee);}));return function(_x2){return _ref4.apply(this,arguments);};}():_ref$customProcessor;if(!(params.limit===null)){_context2.next=3;break;}throw new Error(\"limit cannot be 'null'\");case 3:limit=params.limit||DEFAULT_LIMIT;nextId=params.lower_bound||START_ID;rows=[];case 6:if(!true){_context2.next=29;break;}console.log(\"Loading wax data \".concat(params.code,\":\").concat(params.table,\" from \").concat(nextId,\" +\").concat(DEFAULT_LIMIT));_context2.next=10;return fetchWaxData(_objectSpread({limit:limit,lower_bound:nextId,upper_bound:null,show_payer:false,reverse:false,json:true,key_type:\"\",index_position:1},params));case 10:nextRows=_context2.sent;if(!(nextRows.length===0)){_context2.next=13;break;}return _context2.abrupt(\"return\",rows);case 13:processedNextRows=[];rowIndex=0;case 15:if(!(rowIndex<nextRows.length)){_context2.next=24;break;}nextRow=nextRows[rowIndex];_context2.next=19;return customProcessor({row:nextRow});case 19:processedNextRow=_context2.sent;processedNextRows.push(processedNextRow);case 21:rowIndex++;_context2.next=15;break;case 24:rows=[].concat(_toConsumableArray(rows),processedNextRows);lastRow=nextRows[nextRows.length-1];nextId=lastRow.id+1;_context2.next=6;break;case 29:case\"end\":return _context2.stop();}},_callee2);}));return function fetchAllWaxData(_x){return _ref2.apply(this,arguments);};}();module.exports=fetchAllWaxData;","map":{"version":3,"names":["_","require","fetchWaxData","DEFAULT_LIMIT","START_ID","fetchAllWaxData","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","_ref","params","_ref$customProcessor","customProcessor","limit","nextId","rows","nextRows","processedNextRows","rowIndex","nextRow","processedNextRow","lastRow","wrap","_callee2$","_context2","prev","next","_ref4","_callee","_ref3","row","_callee$","_context","abrupt","stop","_x2","apply","arguments","Error","lower_bound","console","log","concat","code","table","_objectSpread","upper_bound","show_payer","reverse","json","key_type","index_position","sent","length","push","_toConsumableArray","id","_x","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/core/fetchAllWaxData.js"],"sourcesContent":["const _ = require('lodash');\nconst fetchWaxData = require('./fetchWaxData');\n\nconst DEFAULT_LIMIT = 1000;\nconst START_ID = 1;\n\nconst fetchAllWaxData = async ({\n    params,\n    customProcessor = async ({row}) => row,\n}) => {\n    if (params.limit === null) {\n        throw new Error(`limit cannot be 'null'`);\n    }\n\n    const limit = params.limit || DEFAULT_LIMIT;\n    let nextId = params.lower_bound || START_ID;\n    let rows = [];\n\n    while (true) {\n        console.log(`Loading wax data ${params.code}:${params.table} from ${nextId} +${DEFAULT_LIMIT}`);\n        const nextRows = await fetchWaxData({\n            limit,\n            lower_bound: nextId,\n            upper_bound: null,\n            show_payer: false,\n            reverse: false,\n            json: true,\n            key_type: \"\",\n            index_position: 1,\n            ...params,\n        });\n\n        if (nextRows.length === 0) {\n            return rows;\n        }\n        const processedNextRows = [];\n\n        for (let rowIndex = 0; rowIndex < nextRows.length; rowIndex++) {\n            const nextRow = nextRows[rowIndex];\n            const processedNextRow = await customProcessor({row: nextRow});\n            processedNextRows.push(processedNextRow);\n        }\n        \n        rows = [\n            ...rows,\n            ...processedNextRows,\n        ];\n\n        const lastRow = nextRows[nextRows.length - 1];\n        nextId = lastRow.id + 1;\n    }\n};\n\nmodule.exports = fetchAllWaxData;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}