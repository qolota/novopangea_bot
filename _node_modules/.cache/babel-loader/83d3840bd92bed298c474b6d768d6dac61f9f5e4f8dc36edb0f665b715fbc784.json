{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _classCallCheck = require(\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WaxSigningApi = void 0;\nvar eosjs_ecc_migration_1 = require(\"eosjs/dist/eosjs-ecc-migration\");\nvar helpers_1 = require(\"./helpers\");\nvar version_1 = require(\"./version\");\nvar WaxEventSource_1 = require(\"./WaxEventSource\");\nfunction getCurrentTime() {\n  return Math.floor(new Date().getTime());\n}\nvar WaxSigningApi = /*#__PURE__*/function () {\n  function WaxSigningApi(waxSigningURL, waxAutoSigningURL, rpc, metricURL, returnTempAccount) {\n    _classCallCheck(this, WaxSigningApi);\n    this.waxSigningURL = waxSigningURL;\n    this.waxAutoSigningURL = waxAutoSigningURL;\n    this.rpc = rpc;\n    this.metricURL = metricURL;\n    this.returnTempAccount = returnTempAccount;\n    this.nonce = \"\";\n    this.waxEventSource = new WaxEventSource_1.WaxEventSource(waxSigningURL);\n    this.metricURL = metricURL;\n    this.returnTempAccount = returnTempAccount;\n    this.rpc = rpc;\n  }\n  _createClass(WaxSigningApi, [{\n    key: \"logout\",\n    value: function logout() {\n      this.user = null;\n    }\n  }, {\n    key: \"login\",\n    value: function login(nonce) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (this.user) {\n                _context.next = 4;\n                break;\n              }\n              this.nonce = nonce;\n              _context.next = 4;\n              return this.loginViaWindow();\n            case 4:\n              if (!this.user) {\n                _context.next = 6;\n                break;\n              }\n              return _context.abrupt(\"return\", this.user);\n            case 6:\n              throw new Error(\"Login failed\");\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n    }\n  }, {\n    key: \"tryAutologin\",\n    value: function tryAutologin() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!this.user) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\", true);\n            case 2:\n              _context2.prev = 2;\n              _context2.next = 5;\n              return this.loginViaEndpoint();\n            case 5:\n              return _context2.abrupt(\"return\", true);\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](2);\n              return _context2.abrupt(\"return\", false);\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[2, 8]]);\n      }));\n    }\n  }, {\n    key: \"prepareTransaction\",\n    value: function prepareTransaction(transaction) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (this.canAutoSign(transaction)) {\n                _context3.next = 4;\n                break;\n              }\n              _context3.next = 3;\n              return this.waxEventSource.openPopup(\"\".concat(this.waxSigningURL, \"/cloud-wallet/signing/\"));\n            case 3:\n              this.signingWindow = _context3.sent;\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n    }\n  }, {\n    key: \"metricLog\",\n    value: function metricLog(name) {\n      var value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var tags = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              if (!(this.metricURL !== \"\")) {\n                _context4.next = 4;\n                break;\n              }\n              _context4.next = 4;\n              return fetch(this.metricURL, {\n                method: \"POST\",\n                headers: {\n                  Accept: \"application/json\",\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                  name: name,\n                  value: value,\n                  tags: tags\n                })\n              });\n            case 4:\n              _context4.next = 9;\n              break;\n            case 6:\n              _context4.prev = 6;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.debug(_context4.t0);\n              // do nothing\n            case 9:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 6]]);\n      }));\n    }\n  }, {\n    key: \"signing\",\n    value: function signing(transaction, serializedTransaction) {\n      var noModify = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var feeFallback = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var startTime, res;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!this.canAutoSign(transaction)) {\n                _context5.next = 13;\n                break;\n              }\n              _context5.prev = 1;\n              startTime = getCurrentTime();\n              _context5.next = 5;\n              return this.signViaEndpoint(serializedTransaction, noModify, feeFallback);\n            case 5:\n              res = _context5.sent;\n              _context5.next = 8;\n              return this.metricLog(\"waxjs.metric.auto_signing\", getCurrentTime() - startTime, []);\n            case 8:\n              return _context5.abrupt(\"return\", res);\n            case 11:\n              _context5.prev = 11;\n              _context5.t0 = _context5[\"catch\"](1);\n            case 13:\n              _context5.next = 15;\n              return this.signViaWindow(serializedTransaction, this.signingWindow, noModify, feeFallback);\n            case 15:\n              return _context5.abrupt(\"return\", _context5.sent);\n            case 16:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this, [[1, 11]]);\n      }));\n    }\n  }, {\n    key: \"proofWindow\",\n    value: function proofWindow(nonce, type, description) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var verifyUrl, referWindow;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              verifyUrl = \"\".concat(this.waxSigningURL, \"/cloud-wallet/verify\");\n              _context6.next = 3;\n              return this.waxEventSource.openEventSource(verifyUrl, {\n                type: \"VERIFY\",\n                nonce: nonce,\n                proof_type: type,\n                description: description\n              });\n            case 3:\n              referWindow = _context6.sent;\n              return _context6.abrupt(\"return\", this.waxEventSource.onceEvent(referWindow, this.waxSigningURL, this.receiveVerfication.bind(this), undefined));\n            case 5:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n    }\n  }, {\n    key: \"loginViaWindow\",\n    value: function loginViaWindow() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        var url, confirmationWindow;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              url = new URL(\"\".concat(this.waxSigningURL, \"/cloud-wallet/login\"));\n              if (this.returnTempAccount) {\n                url.searchParams.append(\"returnTemp\", \"true\");\n              }\n              if (version_1.version) {\n                url.searchParams.append(\"v\", Buffer.from(version_1.version).toString(\"base64\"));\n              }\n              if (this.nonce) {\n                url.searchParams.append(\"n\", Buffer.from(this.nonce).toString(\"base64\"));\n              }\n              _context7.next = 6;\n              return this.waxEventSource.openEventSource(url.toString());\n            case 6:\n              confirmationWindow = _context7.sent;\n              return _context7.abrupt(\"return\", this.waxEventSource.onceEvent(confirmationWindow, this.waxSigningURL, this.receiveLogin.bind(this), undefined));\n            case 8:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n    }\n  }, {\n    key: \"loginViaEndpoint\",\n    value: function loginViaEndpoint() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n        var url, response, data;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              url = new URL(\"\".concat(this.waxAutoSigningURL, \"login\"));\n              if (this.returnTempAccount) {\n                url.search = \"returnTemp=true\";\n              } else {\n                url.search = \"\";\n              }\n              _context8.next = 4;\n              return fetch(url.toString(), {\n                credentials: \"include\",\n                method: \"get\"\n              });\n            case 4:\n              response = _context8.sent;\n              if (response.ok) {\n                _context8.next = 7;\n                break;\n              }\n              throw new Error(\"Login Endpoint Error \".concat(response.status, \" \").concat(response.statusText));\n            case 7:\n              _context8.next = 9;\n              return response.json();\n            case 9:\n              data = _context8.sent;\n              if (!(data.processed && data.processed.except)) {\n                _context8.next = 12;\n                break;\n              }\n              throw new Error(data);\n            case 12:\n              return _context8.abrupt(\"return\", this.receiveLogin({\n                data: data\n              }));\n            case 13:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee8, this);\n      }));\n    }\n  }, {\n    key: \"signViaEndpoint\",\n    value: function signViaEndpoint(serializedTransaction) {\n      var noModify = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var feeFallback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n        var controller, response, data;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              controller = new AbortController();\n              setTimeout(function () {\n                return controller.abort();\n              }, 5000);\n              _context9.next = 4;\n              return fetch(\"\".concat(this.waxAutoSigningURL, \"signing\"), {\n                body: JSON.stringify({\n                  freeBandwidth: !noModify,\n                  feeFallback: feeFallback,\n                  transaction: Object.values(serializedTransaction)\n                }),\n                credentials: \"include\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                method: \"POST\",\n                signal: controller.signal\n              });\n            case 4:\n              response = _context9.sent;\n              if (response.ok) {\n                _context9.next = 8;\n                break;\n              }\n              this.whitelistedContracts = [];\n              throw new Error(\"Signing Endpoint Error \".concat(response.status, \" \").concat(response.statusText));\n            case 8:\n              _context9.next = 10;\n              return response.json();\n            case 10:\n              data = _context9.sent;\n              if (!(data.processed && data.processed.except)) {\n                _context9.next = 14;\n                break;\n              }\n              this.whitelistedContracts = [];\n              throw new Error(\"Error returned from signing endpoint: \".concat(JSON.stringify(data)));\n            case 14:\n              return _context9.abrupt(\"return\", this.receiveSignatures({\n                data: data\n              }));\n            case 15:\n            case \"end\":\n              return _context9.stop();\n          }\n        }, _callee9, this);\n      }));\n    }\n  }, {\n    key: \"receiveVerfication\",\n    value: function receiveVerfication(event) {\n      if (event.data.type === \"DENY\") {\n        throw new Error(\"User Denied Verification\");\n      }\n      return Object.assign({}, event.data);\n    }\n  }, {\n    key: \"signViaWindow\",\n    value: function signViaWindow(serializedTransaction, window) {\n      var noModify = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var feeFallback = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {\n        var startTime, confirmationWindow;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              startTime = getCurrentTime();\n              _context10.next = 3;\n              return this.waxEventSource.openEventSource(\"\".concat(this.waxSigningURL, \"/cloud-wallet/signing/\"), {\n                startTime: startTime,\n                feeFallback: feeFallback,\n                freeBandwidth: !noModify,\n                transaction: serializedTransaction,\n                type: \"TRANSACTION\"\n              }, window);\n            case 3:\n              confirmationWindow = _context10.sent;\n              return _context10.abrupt(\"return\", this.waxEventSource.onceEvent(confirmationWindow, this.waxSigningURL, this.receiveSignatures.bind(this), \"TX_SIGNED\"));\n            case 5:\n            case \"end\":\n              return _context10.stop();\n          }\n        }, _callee10, this);\n      }));\n    }\n  }, {\n    key: \"receiveLogin\",\n    value: function receiveLogin(event) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {\n        var _event$data, verified, userAccount, pubKeys, whitelistedContracts, isTemp, createData, avatarUrl, trustScore, proof, isProofVerified, message;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              _event$data = event.data, verified = _event$data.verified, userAccount = _event$data.userAccount, pubKeys = _event$data.pubKeys, whitelistedContracts = _event$data.whitelistedContracts, isTemp = _event$data.isTemp, createData = _event$data.createData, avatarUrl = _event$data.avatar_url, trustScore = _event$data.trustScore, proof = _event$data.proof;\n              isProofVerified = false;\n              if (verified) {\n                _context11.next = 4;\n                break;\n              }\n              throw new Error(\"User declined to share their user account\");\n            case 4:\n              if (!(!userAccount || !pubKeys)) {\n                _context11.next = 6;\n                break;\n              }\n              throw new Error(\"User does not have a blockchain account\");\n            case 6:\n              if (!((proof === null || proof === void 0 ? void 0 : proof.verified) && this.nonce)) {\n                _context11.next = 15;\n                break;\n              }\n              // handle proof logic\n              message = \"cloudwallet-verification-\".concat(proof.data.referer, \"-\").concat(this.nonce, \"-\").concat(userAccount);\n              _context11.t0 = eosjs_ecc_migration_1.ecc;\n              _context11.t1 = proof.data.signature;\n              _context11.t2 = message;\n              _context11.next = 13;\n              return (0, helpers_1.getProofWaxRequiredKeys)(this.rpc.endpoint);\n            case 13:\n              _context11.t3 = _context11.sent;\n              isProofVerified = _context11.t0.verify.call(_context11.t0, _context11.t1, _context11.t2, _context11.t3);\n            case 15:\n              this.whitelistedContracts = whitelistedContracts || [];\n              this.user = {\n                account: userAccount,\n                keys: pubKeys,\n                isTemp: isTemp,\n                createData: createData,\n                avatarUrl: avatarUrl,\n                trustScore: trustScore,\n                isProofVerified: isProofVerified\n              };\n              return _context11.abrupt(\"return\", true);\n            case 18:\n            case \"end\":\n              return _context11.stop();\n          }\n        }, _callee11, this);\n      }));\n    }\n  }, {\n    key: \"receiveSignatures\",\n    value: function receiveSignatures(event) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {\n        var _event$data2, verified, signatures, whitelistedContracts, serializedTransaction, startTime;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) switch (_context12.prev = _context12.next) {\n            case 0:\n              if (!(event.data.type === \"TX_SIGNED\")) {\n                _context12.next = 7;\n                break;\n              }\n              _event$data2 = event.data, verified = _event$data2.verified, signatures = _event$data2.signatures, whitelistedContracts = _event$data2.whitelistedContracts, serializedTransaction = _event$data2.serializedTransaction, startTime = _event$data2.startTime;\n              if (!(!verified || !signatures)) {\n                _context12.next = 4;\n                break;\n              }\n              throw new Error(\"User declined to sign the transaction\");\n            case 4:\n              this.whitelistedContracts = whitelistedContracts || [];\n              if (startTime && startTime > 0) {\n                this.metricLog(\"waxjs.metric.manual_sign_transaction_time\", getCurrentTime() - startTime, []);\n              }\n              return _context12.abrupt(\"return\", {\n                serializedTransaction: serializedTransaction,\n                signatures: signatures\n              });\n            case 7:\n              throw new Error(\"Unexpected response received when attempting signing: \".concat(JSON.stringify(event.data)));\n            case 8:\n            case \"end\":\n              return _context12.stop();\n          }\n        }, _callee12, this);\n      }));\n    }\n  }, {\n    key: \"canAutoSign\",\n    value: function canAutoSign(transaction) {\n      var _this = this;\n      var ua = navigator.userAgent.toLowerCase();\n      if (ua.search(\"chrome\") === -1 && ua.search(\"safari\") >= 0) {\n        return false;\n      }\n      return !transaction.actions.find(function (action) {\n        return !_this.isWhitelisted(action);\n      });\n    }\n  }, {\n    key: \"isWhitelisted\",\n    value: function isWhitelisted(action) {\n      return !!(this.whitelistedContracts && !!this.whitelistedContracts.find(function (w) {\n        if (w.contract === action.account) {\n          if (action.account === \"eosio.token\" && action.name === \"transfer\") {\n            return w.recipients.includes(action.data.to);\n          }\n          return true;\n        }\n        return false;\n      }));\n    }\n  }]);\n  return WaxSigningApi;\n}();\nexports.WaxSigningApi = WaxSigningApi;","map":{"version":3,"names":["_regeneratorRuntime","require","default","_classCallCheck","_createClass","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","WaxSigningApi","eosjs_ecc_migration_1","helpers_1","version_1","WaxEventSource_1","getCurrentTime","Math","floor","Date","getTime","waxSigningURL","waxAutoSigningURL","rpc","metricURL","returnTempAccount","nonce","waxEventSource","WaxEventSource","key","logout","user","login","mark","_callee","wrap","_callee$","_context","prev","loginViaWindow","abrupt","Error","stop","tryAutologin","_callee2","_callee2$","_context2","loginViaEndpoint","t0","prepareTransaction","transaction","_callee3","_callee3$","_context3","canAutoSign","openPopup","concat","signingWindow","sent","metricLog","name","arguments","length","undefined","tags","_callee4","_callee4$","_context4","fetch","method","headers","Accept","body","JSON","stringify","console","debug","signing","serializedTransaction","noModify","feeFallback","_callee5","startTime","res","_callee5$","_context5","signViaEndpoint","signViaWindow","proofWindow","type","description","_callee6","verifyUrl","referWindow","_callee6$","_context6","openEventSource","proof_type","onceEvent","receiveVerfication","bind","_callee7","url","confirmationWindow","_callee7$","_context7","URL","searchParams","append","version","Buffer","from","toString","receiveLogin","_callee8","response","data","_callee8$","_context8","search","credentials","ok","status","statusText","json","processed","except","_callee9","controller","_callee9$","_context9","AbortController","setTimeout","abort","freeBandwidth","values","signal","whitelistedContracts","receiveSignatures","event","assign","window","_callee10","_callee10$","_context10","_callee11","_event$data","verified","userAccount","pubKeys","isTemp","createData","avatarUrl","trustScore","proof","isProofVerified","message","_callee11$","_context11","avatar_url","referer","ecc","t1","signature","t2","getProofWaxRequiredKeys","endpoint","t3","verify","call","account","keys","_callee12","_event$data2","signatures","_callee12$","_context12","_this","ua","navigator","userAgent","toLowerCase","actions","find","action","isWhitelisted","w","contract","recipients","includes","to"],"sources":["/Users/germangurov/projects/wax_bot/node_modules/@waxio/waxjs/dist/WaxSigningApi.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WaxSigningApi = void 0;\nconst eosjs_ecc_migration_1 = require(\"eosjs/dist/eosjs-ecc-migration\");\nconst helpers_1 = require(\"./helpers\");\nconst version_1 = require(\"./version\");\nconst WaxEventSource_1 = require(\"./WaxEventSource\");\nfunction getCurrentTime() {\n    return Math.floor(new Date().getTime());\n}\nclass WaxSigningApi {\n    constructor(waxSigningURL, waxAutoSigningURL, rpc, metricURL, returnTempAccount) {\n        this.waxSigningURL = waxSigningURL;\n        this.waxAutoSigningURL = waxAutoSigningURL;\n        this.rpc = rpc;\n        this.metricURL = metricURL;\n        this.returnTempAccount = returnTempAccount;\n        this.nonce = \"\";\n        this.waxEventSource = new WaxEventSource_1.WaxEventSource(waxSigningURL);\n        this.metricURL = metricURL;\n        this.returnTempAccount = returnTempAccount;\n        this.rpc = rpc;\n    }\n    logout() {\n        this.user = null;\n    }\n    login(nonce) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.user) {\n                this.nonce = nonce;\n                yield this.loginViaWindow();\n            }\n            if (this.user) {\n                return this.user;\n            }\n            throw new Error(\"Login failed\");\n        });\n    }\n    tryAutologin() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.user) {\n                return true;\n            }\n            try {\n                yield this.loginViaEndpoint();\n                return true;\n            }\n            catch (e) {\n                return false;\n            }\n        });\n    }\n    prepareTransaction(transaction) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.canAutoSign(transaction)) {\n                this.signingWindow = yield this.waxEventSource.openPopup(`${this.waxSigningURL}/cloud-wallet/signing/`);\n            }\n        });\n    }\n    metricLog(name, value = 0, tags = []) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                if (this.metricURL !== \"\") {\n                    yield fetch(this.metricURL, {\n                        method: \"POST\",\n                        headers: {\n                            Accept: \"application/json\",\n                            \"Content-Type\": \"application/json\",\n                        },\n                        body: JSON.stringify({ name, value, tags }),\n                    });\n                }\n            }\n            catch (e) {\n                console.debug(e);\n                // do nothing\n            }\n        });\n    }\n    signing(transaction, serializedTransaction, noModify = false, feeFallback = true) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.canAutoSign(transaction)) {\n                try {\n                    const startTime = getCurrentTime();\n                    const res = yield this.signViaEndpoint(serializedTransaction, noModify, feeFallback);\n                    yield this.metricLog(\"waxjs.metric.auto_signing\", getCurrentTime() - startTime, []);\n                    return res;\n                }\n                catch (_a) {\n                    // handle by continuing\n                }\n            }\n            return yield this.signViaWindow(serializedTransaction, this.signingWindow, noModify, feeFallback);\n        });\n    }\n    proofWindow(nonce, type, description) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const verifyUrl = `${this.waxSigningURL}/cloud-wallet/verify`;\n            const referWindow = yield this.waxEventSource.openEventSource(verifyUrl, {\n                type: \"VERIFY\",\n                nonce,\n                proof_type: type,\n                description,\n            });\n            return this.waxEventSource.onceEvent(referWindow, this.waxSigningURL, this.receiveVerfication.bind(this), undefined);\n        });\n    }\n    loginViaWindow() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const url = new URL(`${this.waxSigningURL}/cloud-wallet/login`);\n            if (this.returnTempAccount) {\n                url.searchParams.append(\"returnTemp\", \"true\");\n            }\n            if (version_1.version) {\n                url.searchParams.append(\"v\", Buffer.from(version_1.version).toString(\"base64\"));\n            }\n            if (this.nonce) {\n                url.searchParams.append(\"n\", Buffer.from(this.nonce).toString(\"base64\"));\n            }\n            const confirmationWindow = yield this.waxEventSource.openEventSource(url.toString());\n            return this.waxEventSource.onceEvent(confirmationWindow, this.waxSigningURL, this.receiveLogin.bind(this), undefined);\n        });\n    }\n    loginViaEndpoint() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const url = new URL(`${this.waxAutoSigningURL}login`);\n            if (this.returnTempAccount) {\n                url.search = \"returnTemp=true\";\n            }\n            else {\n                url.search = \"\";\n            }\n            const response = yield fetch(url.toString(), {\n                credentials: \"include\",\n                method: \"get\",\n            });\n            if (!response.ok) {\n                throw new Error(`Login Endpoint Error ${response.status} ${response.statusText}`);\n            }\n            const data = yield response.json();\n            if (data.processed && data.processed.except) {\n                throw new Error(data);\n            }\n            return this.receiveLogin({ data });\n        });\n    }\n    signViaEndpoint(serializedTransaction, noModify = false, feeFallback = true) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const controller = new AbortController();\n            setTimeout(() => controller.abort(), 5000);\n            const response = yield fetch(`${this.waxAutoSigningURL}signing`, {\n                body: JSON.stringify({\n                    freeBandwidth: !noModify,\n                    feeFallback,\n                    transaction: Object.values(serializedTransaction),\n                }),\n                credentials: \"include\",\n                headers: { \"Content-Type\": \"application/json\" },\n                method: \"POST\",\n                signal: controller.signal,\n            });\n            if (!response.ok) {\n                this.whitelistedContracts = [];\n                throw new Error(`Signing Endpoint Error ${response.status} ${response.statusText}`);\n            }\n            const data = yield response.json();\n            if (data.processed && data.processed.except) {\n                this.whitelistedContracts = [];\n                throw new Error(`Error returned from signing endpoint: ${JSON.stringify(data)}`);\n            }\n            return this.receiveSignatures({ data });\n        });\n    }\n    receiveVerfication(event) {\n        if (event.data.type === \"DENY\") {\n            throw new Error(\"User Denied Verification\");\n        }\n        return Object.assign({}, event.data);\n    }\n    signViaWindow(serializedTransaction, window, noModify = false, feeFallback = true) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const startTime = getCurrentTime();\n            const confirmationWindow = yield this.waxEventSource.openEventSource(`${this.waxSigningURL}/cloud-wallet/signing/`, {\n                startTime,\n                feeFallback,\n                freeBandwidth: !noModify,\n                transaction: serializedTransaction,\n                type: \"TRANSACTION\",\n            }, window);\n            return this.waxEventSource.onceEvent(confirmationWindow, this.waxSigningURL, this.receiveSignatures.bind(this), \"TX_SIGNED\");\n        });\n    }\n    receiveLogin(event) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { verified, userAccount, pubKeys, whitelistedContracts, isTemp, createData, avatar_url: avatarUrl, trustScore, proof, } = event.data;\n            let isProofVerified = false;\n            if (!verified) {\n                throw new Error(\"User declined to share their user account\");\n            }\n            if (!userAccount || !pubKeys) {\n                throw new Error(\"User does not have a blockchain account\");\n            }\n            if ((proof === null || proof === void 0 ? void 0 : proof.verified) && this.nonce) {\n                // handle proof logic\n                const message = `cloudwallet-verification-${proof.data.referer}-${this.nonce}-${userAccount}`;\n                isProofVerified = eosjs_ecc_migration_1.ecc.verify(proof.data.signature, message, yield (0, helpers_1.getProofWaxRequiredKeys)(this.rpc.endpoint));\n            }\n            this.whitelistedContracts = whitelistedContracts || [];\n            this.user = {\n                account: userAccount,\n                keys: pubKeys,\n                isTemp,\n                createData,\n                avatarUrl,\n                trustScore,\n                isProofVerified,\n            };\n            return true;\n        });\n    }\n    receiveSignatures(event) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (event.data.type === \"TX_SIGNED\") {\n                const { verified, signatures, whitelistedContracts, serializedTransaction, startTime, } = event.data;\n                if (!verified || !signatures) {\n                    throw new Error(\"User declined to sign the transaction\");\n                }\n                this.whitelistedContracts = whitelistedContracts || [];\n                if (startTime && startTime > 0) {\n                    this.metricLog(\"waxjs.metric.manual_sign_transaction_time\", getCurrentTime() - startTime, []);\n                }\n                return { serializedTransaction, signatures };\n            }\n            throw new Error(`Unexpected response received when attempting signing: ${JSON.stringify(event.data)}`);\n        });\n    }\n    canAutoSign(transaction) {\n        const ua = navigator.userAgent.toLowerCase();\n        if (ua.search(\"chrome\") === -1 && ua.search(\"safari\") >= 0) {\n            return false;\n        }\n        return !transaction.actions.find((action) => !this.isWhitelisted(action));\n    }\n    isWhitelisted(action) {\n        return !!(this.whitelistedContracts &&\n            !!this.whitelistedContracts.find((w) => {\n                if (w.contract === action.account) {\n                    if (action.account === \"eosio.token\" && action.name === \"transfer\") {\n                        return w.recipients.includes(action.data.to);\n                    }\n                    return true;\n                }\n                return false;\n            }));\n    }\n}\nexports.WaxSigningApi = WaxSigningApi;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}