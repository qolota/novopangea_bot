{"ast":null,"code":"import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _=require('lodash');var fetchAllWaxData2=require('../../core/fetchAllWaxData2');var CONTRACTS=require('../consts/CONTRACTS');var mapResources=require('../utils/mapResources');var convertAllCosts=require('../utils/convertAllCosts');var fetchExchange=require('./fetchExchange');var fetchNovoPrice=require('./fetchNovoPrice');var mapResource=require('../utils/mapResource');var fetchAccounts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref){var _ref$cache,cache,exchange,novoPrice,novoAccounts,accounts;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_ref$cache=_ref.cache,cache=_ref$cache===void 0?{}:_ref$cache;_context.t0=cache.exchange;if(_context.t0){_context.next=6;break;}_context.next=5;return fetchExchange();case 5:_context.t0=_context.sent;case 6:exchange=_context.t0;_context.t1=cache.novoPrice;if(_context.t1){_context.next=12;break;}_context.next=11;return fetchNovoPrice();case 11:_context.t1=_context.sent;case 12:novoPrice=_context.t1;_context.next=15;return fetchAllWaxData2({params:{code:CONTRACTS.GAME,scope:CONTRACTS.GAME,table:'novotknusers'},customProcessor:function customProcessor(_ref3){var row=_ref3.row;return{accountName:row.account,novoSpent:mapResource(row.spent).value,novoBalance:mapResource(row.novo_converted).value,novoDeposited:mapResource(row.novo_deposited).value,novoStaked:mapResource(row.total_stake_districts),nextChoiceDistrictTime:row.next_choice_district*1000,nextWithdrawBalance:row.next_withdraw_balance*1000,actionsUsed:row.actions_used,homeDistrictId:row.home_district};}});case 15:novoAccounts=_context.sent;_context.next=18;return fetchAllWaxData2({params:{code:CONTRACTS.GAME,scope:CONTRACTS.GAME,table:'accounts'},customProcessor:function customProcessor(_ref4){var row=_ref4.row;var novoAccount=novoAccounts.find(function(account){return account.accountName===row.account;});return{accountName:row.account,level:row.level,score:row.score,balances:_.compact([].concat(_toConsumableArray(mapResources(row.balances)),[novoAccount!=null?{value:novoAccount.novoBalance,symbol:'NOVO'}:null])),maxBalances:mapResources(row.max_balances),totalBalance:convertAllCosts(_objectSpread({costs:[].concat(_toConsumableArray(row.balances),[novoAccount!=null?\"\".concat(novoAccount.novoBalance,\" NOVO\"):\"0  NOVO\"]),exchange:exchange,novoPrice:novoPrice},novoAccount)),nextWithdrawBalance:novoAccount!=null?novoAccount.nextWithdrawBalance:null};}});case 18:accounts=_context.sent;return _context.abrupt(\"return\",accounts);case 20:case\"end\":return _context.stop();}},_callee);}));return function fetchAccounts(_x){return _ref2.apply(this,arguments);};}();module.exports=fetchAccounts;","map":{"version":3,"names":["_","require","fetchAllWaxData2","CONTRACTS","mapResources","convertAllCosts","fetchExchange","fetchNovoPrice","mapResource","fetchAccounts","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","_ref$cache","cache","exchange","novoPrice","novoAccounts","accounts","wrap","_callee$","_context","prev","next","t0","sent","t1","params","code","GAME","scope","table","customProcessor","_ref3","row","accountName","account","novoSpent","spent","value","novoBalance","novo_converted","novoDeposited","novo_deposited","novoStaked","total_stake_districts","nextChoiceDistrictTime","next_choice_district","nextWithdrawBalance","next_withdraw_balance","actionsUsed","actions_used","homeDistrictId","home_district","_ref4","novoAccount","find","level","score","balances","compact","concat","_toConsumableArray","symbol","maxBalances","max_balances","totalBalance","_objectSpread","costs","abrupt","stop","_x","apply","arguments","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/novopangea/api/fetchAccounts.js"],"sourcesContent":["const _ = require('lodash');\nconst fetchAllWaxData2 = require('../../core/fetchAllWaxData2');\nconst CONTRACTS = require('../consts/CONTRACTS');\nconst mapResources = require('../utils/mapResources');\nconst convertAllCosts = require('../utils/convertAllCosts');\nconst fetchExchange = require('./fetchExchange');\nconst fetchNovoPrice = require('./fetchNovoPrice');\nconst mapResource = require('../utils/mapResource');\n\nconst fetchAccounts = async ({\n    cache = {}\n}) => {\n    const exchange = cache.exchange || await fetchExchange();\n    const novoPrice = cache.novoPrice || await fetchNovoPrice();\n    const novoAccounts = await fetchAllWaxData2({\n        params: {\n            code: CONTRACTS.GAME,\n            scope: CONTRACTS.GAME,\n            table: 'novotknusers',\n        },\n        customProcessor: ({row}) => ({\n            accountName: row.account,\n            novoSpent: mapResource(row.spent).value,\n            novoBalance: mapResource(row.novo_converted).value,\n            novoDeposited: mapResource(row.novo_deposited).value,\n            novoStaked: mapResource(row.total_stake_districts),\n            nextChoiceDistrictTime: row.next_choice_district * 1000,\n            nextWithdrawBalance: row.next_withdraw_balance * 1000,\n            actionsUsed: row.actions_used,\n            homeDistrictId: row.home_district,\n        }),\n    });\n\n    \n    const accounts = await fetchAllWaxData2({\n        params: {\n            code: CONTRACTS.GAME,\n            scope: CONTRACTS.GAME,\n            table: 'accounts',\n        },\n        customProcessor: ({row}) => {\n            const novoAccount = novoAccounts.find(account => account.accountName === row.account);\n            \n            return {\n                accountName: row.account,\n                level: row.level,\n                score: row.score,\n                balances: _.compact([\n                    ...mapResources(row.balances),\n                    novoAccount != null\n                        ? {\n                            value: novoAccount.novoBalance,\n                            symbol: 'NOVO'\n                        }\n                        : null,\n                ]),\n                maxBalances: mapResources(row.max_balances),\n                totalBalance: convertAllCosts({\n                    costs: [\n                        ...row.balances,\n                        novoAccount != null\n                            ? `${novoAccount.novoBalance} NOVO`\n                            : `0  NOVO`,\n                    ],\n                    exchange,\n                    novoPrice,\n                    ...novoAccount,\n                }),\n                nextWithdrawBalance: novoAccount != null\n                    ? novoAccount.nextWithdrawBalance\n                    : null,\n            };\n        },\n    });\n\n    return accounts;\n};\n\nmodule.exports = fetchAccounts;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}