{"ast":null,"code":"import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _=require('lodash');var fetchRealms=require('./fetchRealms');var fetchAllWaxData2=require('../../core/fetchAllWaxData2');var CONTRACTS=require('../consts/CONTRACTS');var fetchTownhallAccounts=require('./fetchTownhallAccounts');var fetchDistricts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref){var _ref$cache,cache,realms,townhallAccounts,districts;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_ref$cache=_ref.cache,cache=_ref$cache===void 0?{}:_ref$cache;_context.t0=cache.realms;if(_context.t0){_context.next=6;break;}_context.next=5;return fetchRealms();case 5:_context.t0=_context.sent;case 6:realms=_context.t0;_context.next=9;return fetchTownhallAccounts();case 9:townhallAccounts=_context.sent;_context.next=12;return fetchAllWaxData2({params:{code:CONTRACTS.GAME,scope:CONTRACTS.GAME,table:'districts'},customProcessor:function customProcessor(_ref3){var row=_ref3.row;return{id:row.id,realm:realms.find(function(realm){return realm.id===row.realm_id;}),accounts:_(townhallAccounts).filter(function(account){return account.districtId===row.id;}).value(),number:row.number,level:row.level,balances:row.balances,taxRate:Number(row.tax_rate)};}});case 12:districts=_context.sent;return _context.abrupt(\"return\",districts);case 14:case\"end\":return _context.stop();}},_callee);}));return function fetchDistricts(_x){return _ref2.apply(this,arguments);};}();module.exports=fetchDistricts;","map":{"version":3,"names":["_","require","fetchRealms","fetchAllWaxData2","CONTRACTS","fetchTownhallAccounts","fetchDistricts","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","_ref$cache","cache","realms","townhallAccounts","districts","wrap","_callee$","_context","prev","next","t0","sent","params","code","GAME","scope","table","customProcessor","_ref3","row","id","realm","find","realm_id","accounts","filter","account","districtId","value","number","level","balances","taxRate","Number","tax_rate","abrupt","stop","_x","apply","arguments","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/novopangea/api/fetchDistricts.js"],"sourcesContent":["const _ = require('lodash');\nconst fetchRealms = require('./fetchRealms');\nconst fetchAllWaxData2 = require('../../core/fetchAllWaxData2');\nconst CONTRACTS = require('../consts/CONTRACTS');\nconst fetchTownhallAccounts = require('./fetchTownhallAccounts');\n\nconst fetchDistricts = async ({\n    cache = {},\n}) => {\n    const realms = cache.realms || await fetchRealms();\n    const townhallAccounts = await fetchTownhallAccounts();\n    const districts = await fetchAllWaxData2({\n        params: {\n            code: CONTRACTS.GAME,\n            scope: CONTRACTS.GAME,\n            table: 'districts',\n        },\n        customProcessor: ({row}) => ({\n            id: row.id,\n            realm: realms.find(realm => realm.id === row.realm_id),\n            accounts: _(townhallAccounts)\n                .filter(account => account.districtId === row.id)\n                .value(),\n            number: row.number,\n            level: row.level,\n            balances: row.balances,\n            taxRate: Number(row.tax_rate),\n        }),\n    });\n\n    return districts;\n};\n\nmodule.exports = fetchDistricts;"],"mappings":"kQAAA,GAAM,CAAAA,CAAC,CAAGC,OAAO,CAAC,QAAQ,CAAC,CAC3B,GAAM,CAAAC,WAAW,CAAGD,OAAO,CAAC,eAAe,CAAC,CAC5C,GAAM,CAAAE,gBAAgB,CAAGF,OAAO,CAAC,6BAA6B,CAAC,CAC/D,GAAM,CAAAG,SAAS,CAAGH,OAAO,CAAC,qBAAqB,CAAC,CAChD,GAAM,CAAAI,qBAAqB,CAAGJ,OAAO,CAAC,yBAAyB,CAAC,CAEhE,GAAM,CAAAK,cAAc,6BAAAC,KAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAAC,IAAA,MAAAC,UAAA,CAAAC,KAAA,CAAAC,MAAA,CAAAC,gBAAA,CAAAC,SAAA,QAAAR,mBAAA,GAAAS,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAT,UAAA,CAAAD,IAAA,CACnBE,KAAK,CAALA,KAAK,CAAAD,UAAA,UAAG,CAAC,CAAC,CAAAA,UAAA,CAAAO,QAAA,CAAAG,EAAA,CAEKT,KAAK,CAACC,MAAM,IAAAK,QAAA,CAAAG,EAAA,EAAAH,QAAA,CAAAE,IAAA,UAAAF,QAAA,CAAAE,IAAA,SAAU,CAAApB,WAAW,CAAC,CAAC,QAAAkB,QAAA,CAAAG,EAAA,CAAAH,QAAA,CAAAI,IAAA,QAA5CT,MAAM,CAAAK,QAAA,CAAAG,EAAA,CAAAH,QAAA,CAAAE,IAAA,SACmB,CAAAjB,qBAAqB,CAAC,CAAC,QAAhDW,gBAAgB,CAAAI,QAAA,CAAAI,IAAA,CAAAJ,QAAA,CAAAE,IAAA,UACE,CAAAnB,gBAAgB,CAAC,CACrCsB,MAAM,CAAE,CACJC,IAAI,CAAEtB,SAAS,CAACuB,IAAI,CACpBC,KAAK,CAAExB,SAAS,CAACuB,IAAI,CACrBE,KAAK,CAAE,WACX,CAAC,CACDC,eAAe,CAAE,SAAAA,gBAAAC,KAAA,KAAE,CAAAC,GAAG,CAAAD,KAAA,CAAHC,GAAG,OAAO,CACzBC,EAAE,CAAED,GAAG,CAACC,EAAE,CACVC,KAAK,CAAEnB,MAAM,CAACoB,IAAI,CAAC,SAAAD,KAAK,QAAI,CAAAA,KAAK,CAACD,EAAE,GAAKD,GAAG,CAACI,QAAQ,GAAC,CACtDC,QAAQ,CAAErC,CAAC,CAACgB,gBAAgB,CAAC,CACxBsB,MAAM,CAAC,SAAAC,OAAO,QAAI,CAAAA,OAAO,CAACC,UAAU,GAAKR,GAAG,CAACC,EAAE,GAAC,CAChDQ,KAAK,CAAC,CAAC,CACZC,MAAM,CAAEV,GAAG,CAACU,MAAM,CAClBC,KAAK,CAAEX,GAAG,CAACW,KAAK,CAChBC,QAAQ,CAAEZ,GAAG,CAACY,QAAQ,CACtBC,OAAO,CAAEC,MAAM,CAACd,GAAG,CAACe,QAAQ,CAChC,CAAC,EACL,CAAC,CAAC,SAjBI9B,SAAS,CAAAG,QAAA,CAAAI,IAAA,QAAAJ,QAAA,CAAA4B,MAAA,UAmBR/B,SAAS,2BAAAG,QAAA,CAAA6B,IAAA,MAAAtC,OAAA,GACnB,kBAzBK,CAAAL,cAAcA,CAAA4C,EAAA,SAAA3C,KAAA,CAAA4C,KAAA,MAAAC,SAAA,OAyBnB,CAEDC,MAAM,CAACC,OAAO,CAAGhD,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}