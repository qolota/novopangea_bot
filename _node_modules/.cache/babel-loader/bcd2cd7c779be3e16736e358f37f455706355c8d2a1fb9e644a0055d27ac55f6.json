{"ast":null,"code":"import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _=require('lodash');var fetchAllWaxData=require('../../core/fetchAllWaxData');var CONTRACTS=require('../consts/CONTRACTS');var convertDex=function convertDex(dex,min){var _dex$sym$split=dex.sym.split(','),_dex$sym$split2=_slicedToArray(_dex$sym$split,2),precision=_dex$sym$split2[0],symbol=_dex$sym$split2[1];var _min$split=min.split(' '),_min$split2=_slicedToArray(_min$split,1),minValue=_min$split2[0];return{precision:Number(precision),symbol:symbol,contract:dex.contract,fullTokenName:\"\".concat(symbol,\"+\").concat(dex.contract),min:Number(minValue)};};var groupDexs=function groupDexs(dexs,index){return _(dexs).groupBy(function(dex){return\"\".concat(dex.symbols[index].symbol,\"+\").concat(dex.symbols[index].contract);}).value();};var fetchDEXs=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var dexs,groupedDexs;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetchAllWaxData({params:{code:CONTRACTS.DEX,scope:CONTRACTS.DEX,table:\"markets\"},customProcessor:function(){var _customProcessor=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref2){var row,dex;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:row=_ref2.row;dex={id:row.id,fee:row.fee/100/100,isFrozen:row.frozen,symbols:[convertDex(row.base_token,row.min_buy),convertDex(row.quote_token,row.min_sell)]};return _context.abrupt(\"return\",dex);case 3:case\"end\":return _context.stop();}},_callee);}));function customProcessor(_x){return _customProcessor.apply(this,arguments);}return customProcessor;}()});case 2:dexs=_context2.sent;groupedDexs=_.mergeWith(groupDexs(dexs,0),groupDexs(dexs,1),function(objValue,srcValue){if(_.isArray(objValue)){return objValue.concat(srcValue);}});return _context2.abrupt(\"return\",groupedDexs);case 5:case\"end\":return _context2.stop();}},_callee2);}));return function fetchDEXs(){return _ref.apply(this,arguments);};}();module.exports=fetchDEXs;","map":{"version":3,"names":["_","require","fetchAllWaxData","CONTRACTS","convertDex","dex","min","_dex$sym$split","sym","split","_dex$sym$split2","_slicedToArray","precision","symbol","_min$split","_min$split2","minValue","Number","contract","fullTokenName","concat","groupDexs","dexs","index","groupBy","symbols","value","fetchDEXs","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","groupedDexs","wrap","_callee2$","_context2","prev","next","params","code","DEX","scope","table","customProcessor","_customProcessor","_callee","_ref2","row","_callee$","_context","id","fee","isFrozen","frozen","base_token","min_buy","quote_token","min_sell","abrupt","stop","_x","apply","arguments","sent","mergeWith","objValue","srcValue","isArray","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/alcor/api/fetchDEXs.js"],"sourcesContent":["const _ = require('lodash');\nconst fetchAllWaxData = require('../../core/fetchAllWaxData');\nconst CONTRACTS = require('../consts/CONTRACTS');\n\nconst convertDex = (dex, min) => {\n    const [precision, symbol] = dex.sym.split(',');\n    const [minValue] = min.split(' ');\n\n    return {\n        precision: Number(precision),\n        symbol,\n        contract: dex.contract,\n        fullTokenName: `${symbol}+${dex.contract}`,\n        min: Number(minValue),\n    };\n};\n\nconst groupDexs = (dexs, index) => _(dexs)\n    .groupBy(dex => `${dex.symbols[index].symbol}+${dex.symbols[index].contract}`)\n    .value();\n\nconst fetchDEXs = async () => {\n  const dexs = await fetchAllWaxData({\n    params: {\n        code: CONTRACTS.DEX,\n        scope: CONTRACTS.DEX,\n        table: \"markets\",\n    },\n    customProcessor: async ({row}) => {\n        const dex = {\n          id: row.id,\n          fee: row.fee/100/100,\n          isFrozen: row.frozen,\n          symbols: [\n              convertDex(row.base_token, row.min_buy),\n              convertDex(row.quote_token, row.min_sell),\n          ],\n        };\n\n        return dex;\n    },\n  });\n\n  const groupedDexs = _.mergeWith(\n      groupDexs(dexs, 0),\n      groupDexs(dexs, 1),\n      (objValue, srcValue) => {\n        if (_.isArray(objValue)) {\n        return objValue.concat(srcValue);\n        }\n      }\n    );\n\n   return groupedDexs;\n};\n\nmodule.exports = fetchDEXs;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}