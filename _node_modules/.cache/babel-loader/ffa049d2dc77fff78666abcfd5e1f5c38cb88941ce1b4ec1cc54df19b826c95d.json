{"ast":null,"code":"import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _=require('lodash');var _require=require('./cache'),getCache=_require.getCache,writeCache=_require.writeCache;var _require2=require('../configs/ENDPOINTS'),WAX_BLOCKS_PROVIDER=_require2.WAX_BLOCKS_PROVIDER;var CACHE_WAX_ACCOUNT_KEY='wax_account';var CACHE_WAX_ACCOUNT_DURATION=10*1000;var fetchWaxAccount=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(settings){var res,data,account;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(getCache(CACHE_WAX_ACCOUNT_KEY)!=null)){_context.next=2;break;}return _context.abrupt(\"return\",getCache(CACHE_WAX_ACCOUNT_KEY));case 2:_context.next=4;return fetch(\"\".concat(WAX_BLOCKS_PROVIDER,\"/v1/chain/get_account\"),{headers:{accept:'*/*'},body:JSON.stringify({account_name:settings.accountName}),method:'POST'});case 4:res=_context.sent;_context.next=7;return res.json();case 7:data=_context.sent;account={cpu:data.cpu_limit,net:data.net_limit,cpuLoad:data.cpu_limit.used/data.cpu_limit.max};writeCache(account,CACHE_WAX_ACCOUNT_KEY,CACHE_WAX_ACCOUNT_DURATION);return _context.abrupt(\"return\",account);case 11:case\"end\":return _context.stop();}},_callee);}));return function fetchWaxAccount(_x){return _ref.apply(this,arguments);};}();module.exports=fetchWaxAccount;","map":{"version":3,"names":["_","require","_require","getCache","writeCache","_require2","WAX_BLOCKS_PROVIDER","CACHE_WAX_ACCOUNT_KEY","CACHE_WAX_ACCOUNT_DURATION","fetchWaxAccount","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","settings","res","data","account","wrap","_callee$","_context","prev","next","abrupt","fetch","concat","headers","accept","body","JSON","stringify","account_name","accountName","method","sent","json","cpu","cpu_limit","net","net_limit","cpuLoad","used","max","stop","_x","apply","arguments","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/core/fetchWaxAccount.js"],"sourcesContent":["const _ = require('lodash');\nconst {getCache, writeCache} = require('./cache');\nconst {WAX_BLOCKS_PROVIDER} = require('../configs/ENDPOINTS');\n\nconst CACHE_WAX_ACCOUNT_KEY = 'wax_account';\nconst CACHE_WAX_ACCOUNT_DURATION = 10 * 1000;\n\nconst fetchWaxAccount = async (settings) => {\n  if (getCache(CACHE_WAX_ACCOUNT_KEY) != null) {\n    return getCache(CACHE_WAX_ACCOUNT_KEY);\n  }\n  const res = await fetch(`${WAX_BLOCKS_PROVIDER}/v1/chain/get_account`, {\n    headers: {\n      accept: '*/*',\n    },\n    body: JSON.stringify({\n      account_name: settings.accountName,\n    }),\n    method: 'POST',\n  });\n\n  const data = await res.json();\n  const account = {\n    cpu: data.cpu_limit,\n    net: data.net_limit,\n    cpuLoad: data.cpu_limit.used / data.cpu_limit.max,\n  };\n\n  writeCache(account, CACHE_WAX_ACCOUNT_KEY, CACHE_WAX_ACCOUNT_DURATION);\n  return account;\n};\n\nmodule.exports = fetchWaxAccount;\n"],"mappings":"kQAAA,GAAM,CAAAA,CAAC,CAAGC,OAAO,CAAC,QAAQ,CAAC,CAC3B,IAAAC,QAAA,CAA+BD,OAAO,CAAC,SAAS,CAAC,CAA1CE,QAAQ,CAAAD,QAAA,CAARC,QAAQ,CAAEC,UAAU,CAAAF,QAAA,CAAVE,UAAU,CAC3B,IAAAC,SAAA,CAA8BJ,OAAO,CAAC,sBAAsB,CAAC,CAAtDK,mBAAmB,CAAAD,SAAA,CAAnBC,mBAAmB,CAE1B,GAAM,CAAAC,qBAAqB,CAAG,aAAa,CAC3C,GAAM,CAAAC,0BAA0B,CAAG,EAAE,CAAG,IAAI,CAE5C,GAAM,CAAAC,eAAe,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAOC,QAAQ,MAAAC,GAAA,CAAAC,IAAA,CAAAC,OAAA,QAAAN,mBAAA,GAAAO,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,cACjCpB,QAAQ,CAACI,qBAAqB,CAAC,EAAI,IAAI,GAAAc,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAG,MAAA,UAClCrB,QAAQ,CAACI,qBAAqB,CAAC,SAAAc,QAAA,CAAAE,IAAA,SAEtB,CAAAE,KAAK,IAAAC,MAAA,CAAIpB,mBAAmB,0BAAyB,CACrEqB,OAAO,CAAE,CACPC,MAAM,CAAE,KACV,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBC,YAAY,CAAEjB,QAAQ,CAACkB,WACzB,CAAC,CAAC,CACFC,MAAM,CAAE,MACV,CAAC,CAAC,QARIlB,GAAG,CAAAK,QAAA,CAAAc,IAAA,CAAAd,QAAA,CAAAE,IAAA,SAUU,CAAAP,GAAG,CAACoB,IAAI,CAAC,CAAC,QAAvBnB,IAAI,CAAAI,QAAA,CAAAc,IAAA,CACJjB,OAAO,CAAG,CACdmB,GAAG,CAAEpB,IAAI,CAACqB,SAAS,CACnBC,GAAG,CAAEtB,IAAI,CAACuB,SAAS,CACnBC,OAAO,CAAExB,IAAI,CAACqB,SAAS,CAACI,IAAI,CAAGzB,IAAI,CAACqB,SAAS,CAACK,GAChD,CAAC,CAEDvC,UAAU,CAACc,OAAO,CAAEX,qBAAqB,CAAEC,0BAA0B,CAAC,CAAC,OAAAa,QAAA,CAAAG,MAAA,UAChEN,OAAO,2BAAAG,QAAA,CAAAuB,IAAA,MAAA9B,OAAA,GACf,kBAvBK,CAAAL,eAAeA,CAAAoC,EAAA,SAAAnC,IAAA,CAAAoC,KAAA,MAAAC,SAAA,OAuBpB,CAEDC,MAAM,CAACC,OAAO,CAAGxC,eAAe"},"metadata":{},"sourceType":"module","externalDependencies":[]}