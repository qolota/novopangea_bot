{"ast":null,"code":"\"use strict\";\n\n/**\n * @module JS-Sig\n */\n// copyright defined in eosjs/LICENSE.txt\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function sent() {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function next() {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.JsSignatureProvider = exports.digestFromSerializedData = exports.Signature = exports.PublicKey = exports.PrivateKey = void 0;\nvar elliptic_1 = require(\"elliptic\");\nvar eosjs_key_conversions_1 = require(\"./eosjs-key-conversions\");\nObject.defineProperty(exports, \"PrivateKey\", {\n  enumerable: true,\n  get: function get() {\n    return eosjs_key_conversions_1.PrivateKey;\n  }\n});\nObject.defineProperty(exports, \"PublicKey\", {\n  enumerable: true,\n  get: function get() {\n    return eosjs_key_conversions_1.PublicKey;\n  }\n});\nObject.defineProperty(exports, \"Signature\", {\n  enumerable: true,\n  get: function get() {\n    return eosjs_key_conversions_1.Signature;\n  }\n});\nvar eosjs_numeric_1 = require(\"./eosjs-numeric\");\n/** expensive to construct; so we do it once and reuse it */\nvar defaultEc = new elliptic_1.ec('secp256k1');\n/** Construct the digest from transaction details */\nvar digestFromSerializedData = function digestFromSerializedData(chainId, serializedTransaction, serializedContextFreeData, e) {\n  if (e === void 0) {\n    e = defaultEc;\n  }\n  var signBuf = Buffer.concat([Buffer.from(chainId, 'hex'), Buffer.from(serializedTransaction), Buffer.from(serializedContextFreeData ? new Uint8Array(e.hash().update(serializedContextFreeData).digest()) : new Uint8Array(32))]);\n  return e.hash().update(signBuf).digest();\n};\nexports.digestFromSerializedData = digestFromSerializedData;\n/** Signs transactions using in-process private keys */\nvar JsSignatureProvider = /** @class */function () {\n  /** @param privateKeys private keys to sign with */\n  function JsSignatureProvider(privateKeys) {\n    var e_1, _a;\n    /** map public to private keys */\n    this.keys = new Map();\n    /** public keys */\n    this.availableKeys = [];\n    try {\n      for (var privateKeys_1 = __values(privateKeys), privateKeys_1_1 = privateKeys_1.next(); !privateKeys_1_1.done; privateKeys_1_1 = privateKeys_1.next()) {\n        var k = privateKeys_1_1.value;\n        var priv = eosjs_key_conversions_1.PrivateKey.fromString(k);\n        var privElliptic = priv.toElliptic();\n        var pubStr = priv.getPublicKey().toString();\n        this.keys.set(pubStr, privElliptic);\n        this.availableKeys.push(pubStr);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (privateKeys_1_1 && !privateKeys_1_1.done && (_a = privateKeys_1.return)) _a.call(privateKeys_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  }\n  /** Public keys associated with the private keys that the `SignatureProvider` holds */\n  JsSignatureProvider.prototype.getAvailableKeys = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2 /*return*/, this.availableKeys];\n      });\n    });\n  };\n  /** Sign a transaction */\n  JsSignatureProvider.prototype.sign = function (_a) {\n    var chainId = _a.chainId,\n      requiredKeys = _a.requiredKeys,\n      serializedTransaction = _a.serializedTransaction,\n      serializedContextFreeData = _a.serializedContextFreeData;\n    return __awaiter(this, void 0, void 0, function () {\n      var digest, signatures, requiredKeys_1, requiredKeys_1_1, key, publicKey, ellipticPrivateKey, privateKey, signature;\n      var e_2, _b;\n      return __generator(this, function (_c) {\n        digest = digestFromSerializedData(chainId, serializedTransaction, serializedContextFreeData, defaultEc);\n        signatures = [];\n        try {\n          for (requiredKeys_1 = __values(requiredKeys), requiredKeys_1_1 = requiredKeys_1.next(); !requiredKeys_1_1.done; requiredKeys_1_1 = requiredKeys_1.next()) {\n            key = requiredKeys_1_1.value;\n            publicKey = eosjs_key_conversions_1.PublicKey.fromString(key);\n            ellipticPrivateKey = this.keys.get(eosjs_numeric_1.convertLegacyPublicKey(key));\n            privateKey = eosjs_key_conversions_1.PrivateKey.fromElliptic(ellipticPrivateKey, publicKey.getType());\n            signature = privateKey.sign(digest, false);\n            signatures.push(signature.toString());\n          }\n        } catch (e_2_1) {\n          e_2 = {\n            error: e_2_1\n          };\n        } finally {\n          try {\n            if (requiredKeys_1_1 && !requiredKeys_1_1.done && (_b = requiredKeys_1.return)) _b.call(requiredKeys_1);\n          } finally {\n            if (e_2) throw e_2.error;\n          }\n        }\n        return [2 /*return*/, {\n          signatures: signatures,\n          serializedTransaction: serializedTransaction,\n          serializedContextFreeData: serializedContextFreeData\n        }];\n      });\n    });\n  };\n  return JsSignatureProvider;\n}();\nexports.JsSignatureProvider = JsSignatureProvider;","map":{"version":3,"names":["elliptic_1","require","eosjs_key_conversions_1","Object","defineProperty","exports","enumerable","get","PrivateKey","PublicKey","Signature","eosjs_numeric_1","defaultEc","ec","digestFromSerializedData","chainId","serializedTransaction","serializedContextFreeData","e","signBuf","Buffer","concat","from","Uint8Array","hash","update","digest","JsSignatureProvider","privateKeys","keys","Map","availableKeys","privateKeys_1","__values","privateKeys_1_1","next","done","k","value","priv","fromString","privElliptic","toElliptic","pubStr","getPublicKey","toString","set","push","prototype","getAvailableKeys","sign","_a","requiredKeys","signatures","requiredKeys_1","requiredKeys_1_1","key","publicKey","ellipticPrivateKey","convertLegacyPublicKey","privateKey","fromElliptic","getType","signature"],"sources":["../src/eosjs-jssig.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}