{"ast":null,"code":"const _ = require('lodash');\nconst CONTRACTS = require('../consts/CONTRACTS');\nconst fetchWaxData = require('../../core/fetchWaxData');\nconst fetchQueueV2Fast = async () => {\n  const rows = await fetchWaxData({\n    code: CONTRACTS.APP_V2,\n    index_position: 1,\n    json: true,\n    key_type: \"\",\n    limit: 1000,\n    lower_bound: null,\n    reverse: false,\n    scope: CONTRACTS.APP_V2,\n    show_payer: false,\n    table: \"queue\",\n    upper_bound: null\n  });\n  const requests = _(rows).map(requests => requests.joins.map(request => ({\n    player: requests.player,\n    registeredAt: request.registered_ts,\n    league: request.league,\n    vehicleId: request.vehicle_asset_id,\n    driverIds: [request.driver1_asset_id, request.driver2_asset_id],\n    boost: request.flags === 1,\n    gear: request.gear_id\n  }))).flatten().value();\n  const players = _(requests).groupBy(request => request.player).map((requests, player) => ({\n    player,\n    requests\n  })).value();\n  return {\n    requests,\n    players\n  };\n};\nmodule.exports = fetchQueueV2Fast;","map":{"version":3,"names":["_","require","CONTRACTS","fetchWaxData","fetchQueueV2Fast","rows","code","APP_V2","index_position","json","key_type","limit","lower_bound","reverse","scope","show_payer","table","upper_bound","requests","map","joins","request","player","registeredAt","registered_ts","league","vehicleId","vehicle_asset_id","driverIds","driver1_asset_id","driver2_asset_id","boost","flags","gear","gear_id","flatten","value","players","groupBy","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/novarallywax/api/fetchQueueV2Fast.js"],"sourcesContent":["const _ = require('lodash');\nconst CONTRACTS = require('../consts/CONTRACTS');\nconst fetchWaxData = require('../../core/fetchWaxData');\n\nconst fetchQueueV2Fast = async () => {\n    const rows = await fetchWaxData({\n        code: CONTRACTS.APP_V2,\n        index_position: 1,\n        json: true,\n        key_type: \"\",\n        limit: 1000,\n        lower_bound: null,\n        reverse: false,\n        scope: CONTRACTS.APP_V2,\n        show_payer: false,\n        table: \"queue\",\n        upper_bound: null,\n    });\n\n    const requests = _(rows)\n      .map(requests => requests.joins.map(request => ({\n        player: requests.player,\n        registeredAt: request.registered_ts,\n        league: request.league,\n        vehicleId: request.vehicle_asset_id,\n        driverIds: [\n          request.driver1_asset_id,\n          request.driver2_asset_id,\n        ],\n        boost: request.flags === 1,\n        gear: request.gear_id,\n      })))\n      .flatten()\n      .value();\n    const players = _(requests)\n      .groupBy(request => request.player)\n      .map((requests, player) => ({\n        player,\n        requests,\n      }))\n      .value();\n\n    return {\n      requests,\n      players,\n    };\n}\n\nmodule.exports = fetchQueueV2Fast;\n"],"mappings":"AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAC3B,MAAMC,SAAS,GAAGD,OAAO,CAAC,qBAAqB,CAAC;AAChD,MAAME,YAAY,GAAGF,OAAO,CAAC,yBAAyB,CAAC;AAEvD,MAAMG,gBAAgB,GAAG,MAAAA,CAAA,KAAY;EACjC,MAAMC,IAAI,GAAG,MAAMF,YAAY,CAAC;IAC5BG,IAAI,EAAEJ,SAAS,CAACK,MAAM;IACtBC,cAAc,EAAE,CAAC;IACjBC,IAAI,EAAE,IAAI;IACVC,QAAQ,EAAE,EAAE;IACZC,KAAK,EAAE,IAAI;IACXC,WAAW,EAAE,IAAI;IACjBC,OAAO,EAAE,KAAK;IACdC,KAAK,EAAEZ,SAAS,CAACK,MAAM;IACvBQ,UAAU,EAAE,KAAK;IACjBC,KAAK,EAAE,OAAO;IACdC,WAAW,EAAE;EACjB,CAAC,CAAC;EAEF,MAAMC,QAAQ,GAAGlB,CAAC,CAACK,IAAI,CAAC,CACrBc,GAAG,CAACD,QAAQ,IAAIA,QAAQ,CAACE,KAAK,CAACD,GAAG,CAACE,OAAO,KAAK;IAC9CC,MAAM,EAAEJ,QAAQ,CAACI,MAAM;IACvBC,YAAY,EAAEF,OAAO,CAACG,aAAa;IACnCC,MAAM,EAAEJ,OAAO,CAACI,MAAM;IACtBC,SAAS,EAAEL,OAAO,CAACM,gBAAgB;IACnCC,SAAS,EAAE,CACTP,OAAO,CAACQ,gBAAgB,EACxBR,OAAO,CAACS,gBAAgB,CACzB;IACDC,KAAK,EAAEV,OAAO,CAACW,KAAK,KAAK,CAAC;IAC1BC,IAAI,EAAEZ,OAAO,CAACa;EAChB,CAAC,CAAC,CAAC,CAAC,CACHC,OAAO,CAAC,CAAC,CACTC,KAAK,CAAC,CAAC;EACV,MAAMC,OAAO,GAAGrC,CAAC,CAACkB,QAAQ,CAAC,CACxBoB,OAAO,CAACjB,OAAO,IAAIA,OAAO,CAACC,MAAM,CAAC,CAClCH,GAAG,CAAC,CAACD,QAAQ,EAAEI,MAAM,MAAM;IAC1BA,MAAM;IACNJ;EACF,CAAC,CAAC,CAAC,CACFkB,KAAK,CAAC,CAAC;EAEV,OAAO;IACLlB,QAAQ;IACRmB;EACF,CAAC;AACL,CAAC;AAEDE,MAAM,CAACC,OAAO,GAAGpC,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}