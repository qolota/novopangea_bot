{"ast":null,"code":"const _ = require('lodash');\nconst filterStaleSales = ({\n  sales,\n  otherSalesLowestWaxPrice,\n  sellSettings\n}) => {\n  return _(sales).filter(sale => {\n    let comparePrice = otherSalesLowestWaxPrice;\n    if (comparePrice == null || sellSettings.maxPrice < comparePrice) {\n      comparePrice = sellSettings.maxPrice;\n    }\n    if (sellSettings.minPrice > comparePrice) {\n      comparePrice = sellSettings.minPrice;\n    }\n    if (sale.waxPrice >= comparePrice) {\n      return true;\n    }\n    return 1 - sale.waxPrice / comparePrice > sellSettings.allowedDiscountPriceRate;\n  }).value();\n};\nmodule.exports = filterStaleSales;","map":{"version":3,"names":["_","require","filterStaleSales","sales","otherSalesLowestWaxPrice","sellSettings","filter","sale","comparePrice","maxPrice","minPrice","waxPrice","allowedDiscountPriceRate","value","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/atomicassets/utils/filterStaleSales.js"],"sourcesContent":["const _ = require('lodash');\n\nconst filterStaleSales = ({\n    sales,\n    otherSalesLowestWaxPrice,\n    sellSettings,\n}) => {\n    return _(sales)\n        .filter(sale => {\n            let comparePrice = otherSalesLowestWaxPrice;\n            if (comparePrice == null || sellSettings.maxPrice < comparePrice) {\n                comparePrice = sellSettings.maxPrice;\n            }\n\n            if (sellSettings.minPrice > comparePrice) {\n                comparePrice = sellSettings.minPrice;\n            }\n\n            if (sale.waxPrice >= comparePrice) {\n                return true;\n            }\n\n            return (1 - sale.waxPrice / comparePrice) > sellSettings.allowedDiscountPriceRate;\n        })\n        .value();\n};\n\nmodule.exports = filterStaleSales;"],"mappings":"AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAE3B,MAAMC,gBAAgB,GAAGA,CAAC;EACtBC,KAAK;EACLC,wBAAwB;EACxBC;AACJ,CAAC,KAAK;EACF,OAAOL,CAAC,CAACG,KAAK,CAAC,CACVG,MAAM,CAACC,IAAI,IAAI;IACZ,IAAIC,YAAY,GAAGJ,wBAAwB;IAC3C,IAAII,YAAY,IAAI,IAAI,IAAIH,YAAY,CAACI,QAAQ,GAAGD,YAAY,EAAE;MAC9DA,YAAY,GAAGH,YAAY,CAACI,QAAQ;IACxC;IAEA,IAAIJ,YAAY,CAACK,QAAQ,GAAGF,YAAY,EAAE;MACtCA,YAAY,GAAGH,YAAY,CAACK,QAAQ;IACxC;IAEA,IAAIH,IAAI,CAACI,QAAQ,IAAIH,YAAY,EAAE;MAC/B,OAAO,IAAI;IACf;IAEA,OAAQ,CAAC,GAAGD,IAAI,CAACI,QAAQ,GAAGH,YAAY,GAAIH,YAAY,CAACO,wBAAwB;EACrF,CAAC,CAAC,CACDC,KAAK,CAAC,CAAC;AAChB,CAAC;AAEDC,MAAM,CAACC,OAAO,GAAGb,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}