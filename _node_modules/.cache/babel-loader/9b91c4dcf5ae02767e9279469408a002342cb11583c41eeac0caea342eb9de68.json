{"ast":null,"code":"import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _=require('lodash');var fetchAllWaxData2=require('../../core/fetchAllWaxData2');var CONTRACTS=require('../consts/CONTRACTS');var fetchUpgradeConfigs=require('./fetchUpgradeConfigs');var fetchOngoingUpgrades=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref){var _ref$cache,cache,upgradeConfigs,allConfigs,upgrades;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_ref$cache=_ref.cache,cache=_ref$cache===void 0?{}:_ref$cache;_context.t0=cache.upgradeConfigs;if(_context.t0){_context.next=6;break;}_context.next=5;return fetchUpgradeConfigs({cache:{}});case 5:_context.t0=_context.sent;case 6:upgradeConfigs=_context.t0;allConfigs=[].concat(_toConsumableArray(_(upgradeConfigs.buildings).map(function(group){return group.configs;}).flatten().value()),_toConsumableArray(_(upgradeConfigs.workers).map(function(group){return group.configs;}).flatten().value()));_context.next=10;return fetchAllWaxData2({params:{code:CONTRACTS.GAME,scope:CONTRACTS.GAME,table:'upgradenft'},customProcessor:function customProcessor(_ref3){var row=_ref3.row;return{assetId:row.asset_id,owner:row.owner,endTime:row.end_time*1000,config:allConfigs.find(function(config){return config.id===row.config_id;})};}});case 10:upgrades=_context.sent;return _context.abrupt(\"return\",upgrades);case 12:case\"end\":return _context.stop();}},_callee);}));return function fetchOngoingUpgrades(_x){return _ref2.apply(this,arguments);};}();module.exports=fetchOngoingUpgrades;","map":{"version":3,"names":["_","require","fetchAllWaxData2","CONTRACTS","fetchUpgradeConfigs","fetchOngoingUpgrades","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","_ref$cache","cache","upgradeConfigs","allConfigs","upgrades","wrap","_callee$","_context","prev","next","t0","sent","concat","_toConsumableArray","buildings","map","group","configs","flatten","value","workers","params","code","GAME","scope","table","customProcessor","_ref3","row","assetId","asset_id","owner","endTime","end_time","config","find","id","config_id","abrupt","stop","_x","apply","arguments","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/novopangea/api/fetchOngoingUpgrades.js"],"sourcesContent":["const _ = require('lodash');\nconst fetchAllWaxData2 = require('../../core/fetchAllWaxData2');\nconst CONTRACTS = require('../consts/CONTRACTS');\nconst fetchUpgradeConfigs = require('./fetchUpgradeConfigs');\n\nconst fetchOngoingUpgrades = async ({\n    cache = {},\n}) => {\n    const upgradeConfigs = cache.upgradeConfigs || await fetchUpgradeConfigs({\n        cache: {},\n    });\n\n    const allConfigs = [\n        ..._(upgradeConfigs.buildings)\n            .map(group => group.configs)\n            .flatten()\n            .value(),\n        ..._(upgradeConfigs.workers)\n            .map(group => group.configs)\n            .flatten()\n            .value(),\n    ]\n    const upgrades = await fetchAllWaxData2({\n        params: {\n            code: CONTRACTS.GAME,\n            scope: CONTRACTS.GAME,\n            table: 'upgradenft',\n        },\n        customProcessor: ({row}) => ({\n            assetId: row.asset_id,\n            owner: row.owner,\n            endTime: row.end_time * 1000,\n            config: allConfigs.find(config => config.id === row.config_id),\n        }),\n    });\n\n    return upgrades;\n};\n\nmodule.exports = fetchOngoingUpgrades;"],"mappings":"mYAAA,GAAM,CAAAA,CAAC,CAAGC,OAAO,CAAC,QAAQ,CAAC,CAC3B,GAAM,CAAAC,gBAAgB,CAAGD,OAAO,CAAC,6BAA6B,CAAC,CAC/D,GAAM,CAAAE,SAAS,CAAGF,OAAO,CAAC,qBAAqB,CAAC,CAChD,GAAM,CAAAG,mBAAmB,CAAGH,OAAO,CAAC,uBAAuB,CAAC,CAE5D,GAAM,CAAAI,oBAAoB,6BAAAC,KAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAAC,IAAA,MAAAC,UAAA,CAAAC,KAAA,CAAAC,cAAA,CAAAC,UAAA,CAAAC,QAAA,QAAAR,mBAAA,GAAAS,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAT,UAAA,CAAAD,IAAA,CACzBE,KAAK,CAALA,KAAK,CAAAD,UAAA,UAAG,CAAC,CAAC,CAAAA,UAAA,CAAAO,QAAA,CAAAG,EAAA,CAEaT,KAAK,CAACC,cAAc,IAAAK,QAAA,CAAAG,EAAA,EAAAH,QAAA,CAAAE,IAAA,UAAAF,QAAA,CAAAE,IAAA,SAAU,CAAAjB,mBAAmB,CAAC,CACrES,KAAK,CAAE,CAAC,CACZ,CAAC,CAAC,QAAAM,QAAA,CAAAG,EAAA,CAAAH,QAAA,CAAAI,IAAA,QAFIT,cAAc,CAAAK,QAAA,CAAAG,EAAA,CAIdP,UAAU,IAAAS,MAAA,CAAAC,kBAAA,CACTzB,CAAC,CAACc,cAAc,CAACY,SAAS,CAAC,CACzBC,GAAG,CAAC,SAAAC,KAAK,QAAI,CAAAA,KAAK,CAACC,OAAO,GAAC,CAC3BC,OAAO,CAAC,CAAC,CACTC,KAAK,CAAC,CAAC,EAAAN,kBAAA,CACTzB,CAAC,CAACc,cAAc,CAACkB,OAAO,CAAC,CACvBL,GAAG,CAAC,SAAAC,KAAK,QAAI,CAAAA,KAAK,CAACC,OAAO,GAAC,CAC3BC,OAAO,CAAC,CAAC,CACTC,KAAK,CAAC,CAAC,GAAAZ,QAAA,CAAAE,IAAA,UAEO,CAAAnB,gBAAgB,CAAC,CACpC+B,MAAM,CAAE,CACJC,IAAI,CAAE/B,SAAS,CAACgC,IAAI,CACpBC,KAAK,CAAEjC,SAAS,CAACgC,IAAI,CACrBE,KAAK,CAAE,YACX,CAAC,CACDC,eAAe,CAAE,SAAAA,gBAAAC,KAAA,KAAE,CAAAC,GAAG,CAAAD,KAAA,CAAHC,GAAG,OAAO,CACzBC,OAAO,CAAED,GAAG,CAACE,QAAQ,CACrBC,KAAK,CAAEH,GAAG,CAACG,KAAK,CAChBC,OAAO,CAAEJ,GAAG,CAACK,QAAQ,CAAG,IAAI,CAC5BC,MAAM,CAAE/B,UAAU,CAACgC,IAAI,CAAC,SAAAD,MAAM,QAAI,CAAAA,MAAM,CAACE,EAAE,GAAKR,GAAG,CAACS,SAAS,GACjE,CAAC,EACL,CAAC,CAAC,SAZIjC,QAAQ,CAAAG,QAAA,CAAAI,IAAA,QAAAJ,QAAA,CAAA+B,MAAA,UAcPlC,QAAQ,2BAAAG,QAAA,CAAAgC,IAAA,MAAAzC,OAAA,GAClB,kBAhCK,CAAAL,oBAAoBA,CAAA+C,EAAA,SAAA9C,KAAA,CAAA+C,KAAA,MAAAC,SAAA,OAgCzB,CAEDC,MAAM,CAACC,OAAO,CAAGnD,oBAAoB"},"metadata":{},"sourceType":"module","externalDependencies":[]}