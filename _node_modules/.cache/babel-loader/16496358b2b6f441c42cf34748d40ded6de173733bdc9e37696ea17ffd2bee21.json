{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WaxEventSource = void 0;\nclass WaxEventSource {\n  constructor(waxSigningURL) {\n    this.waxSigningURL = waxSigningURL;\n    this.timeout = () => __awaiter(this, void 0, void 0, function* () {\n      return new Promise((_, reject) => setTimeout(() => reject(new Error(\"Timeout\")), 5000));\n    });\n    this.openEventSource = this.openEventSource.bind(this);\n    this.onceEvent = this.onceEvent.bind(this);\n  }\n  openPopup(url) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const win = yield window.open(url, \"WaxPopup\", \"height=800,width=600\");\n      if (win) {\n        return win;\n      }\n      throw new Error(\"Unable to open popup window\");\n    });\n  }\n  openEventSource(url, message, win) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const openedWindow = win ? win : yield this.openPopup(url);\n      if (!openedWindow) {\n        throw new Error(\"Unable to open a popup window\");\n      }\n      if (typeof message === \"undefined\") {\n        return openedWindow;\n      }\n      const postTransaction = event => __awaiter(this, void 0, void 0, function* () {\n        if (event.data.type === \"READY\") {\n          openedWindow.postMessage(message, this.waxSigningURL);\n        }\n      });\n      const eventPromise = this.onceEvent(openedWindow, this.waxSigningURL, postTransaction, \"READY\");\n      yield Promise.race([eventPromise, this.timeout()]).catch(err => {\n        if (err.message !== \"Timeout\") {\n          throw err;\n        }\n        openedWindow.postMessage(message, this.waxSigningURL);\n      });\n      return openedWindow;\n    });\n  }\n  onceEvent(source, origin, action, type) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return new Promise((resolve, reject) => {\n        let resolved = false;\n        window.addEventListener(\"message\", function onEvent(event) {\n          return __awaiter(this, void 0, void 0, function* () {\n            if (event.origin !== origin) {\n              return;\n            }\n            if (event.source !== source) {\n              return;\n            }\n            if (typeof event.data !== \"object\") {\n              return;\n            }\n            if (type && (!event.data.type || event.data.type !== type)) {\n              return;\n            }\n            try {\n              resolved = true;\n              resolve(yield action(event));\n            } catch (e) {\n              resolved = true;\n              reject(e);\n            }\n            window.removeEventListener(\"message\", onEvent, false);\n          });\n        }, false);\n        const interval = setInterval(() => {\n          if (source.closed && !resolved) {\n            clearInterval(interval);\n            reject(\"user closed the window\");\n          }\n        }, 1000);\n      });\n    });\n  }\n}\nexports.WaxEventSource = WaxEventSource;","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","WaxEventSource","constructor","waxSigningURL","timeout","_","setTimeout","Error","openEventSource","bind","onceEvent","openPopup","url","win","window","open","message","openedWindow","postTransaction","event","data","type","postMessage","eventPromise","race","catch","err","source","origin","action","resolved","addEventListener","onEvent","removeEventListener","interval","setInterval","closed","clearInterval"],"sources":["/Users/germangurov/projects/wax_bot/node_modules/@waxio/waxjs/dist/WaxEventSource.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WaxEventSource = void 0;\nclass WaxEventSource {\n    constructor(waxSigningURL) {\n        this.waxSigningURL = waxSigningURL;\n        this.timeout = () => __awaiter(this, void 0, void 0, function* () {\n            return new Promise((_, reject) => setTimeout(() => reject(new Error(\"Timeout\")), 5000));\n        });\n        this.openEventSource = this.openEventSource.bind(this);\n        this.onceEvent = this.onceEvent.bind(this);\n    }\n    openPopup(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const win = yield window.open(url, \"WaxPopup\", \"height=800,width=600\");\n            if (win) {\n                return win;\n            }\n            throw new Error(\"Unable to open popup window\");\n        });\n    }\n    openEventSource(url, message, win) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const openedWindow = win ? win : yield this.openPopup(url);\n            if (!openedWindow) {\n                throw new Error(\"Unable to open a popup window\");\n            }\n            if (typeof message === \"undefined\") {\n                return openedWindow;\n            }\n            const postTransaction = (event) => __awaiter(this, void 0, void 0, function* () {\n                if (event.data.type === \"READY\") {\n                    openedWindow.postMessage(message, this.waxSigningURL);\n                }\n            });\n            const eventPromise = this.onceEvent(openedWindow, this.waxSigningURL, postTransaction, \"READY\");\n            yield Promise.race([eventPromise, this.timeout()]).catch(err => {\n                if (err.message !== \"Timeout\") {\n                    throw err;\n                }\n                openedWindow.postMessage(message, this.waxSigningURL);\n            });\n            return openedWindow;\n        });\n    }\n    onceEvent(source, origin, action, type) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return new Promise((resolve, reject) => {\n                let resolved = false;\n                window.addEventListener(\"message\", function onEvent(event) {\n                    return __awaiter(this, void 0, void 0, function* () {\n                        if (event.origin !== origin) {\n                            return;\n                        }\n                        if (event.source !== source) {\n                            return;\n                        }\n                        if (typeof event.data !== \"object\") {\n                            return;\n                        }\n                        if (type && (!event.data.type || event.data.type !== type)) {\n                            return;\n                        }\n                        try {\n                            resolved = true;\n                            resolve(yield action(event));\n                        }\n                        catch (e) {\n                            resolved = true;\n                            reject(e);\n                        }\n                        window.removeEventListener(\"message\", onEvent, false);\n                    });\n                }, false);\n                const interval = setInterval(() => {\n                    if (source.closed && !resolved) {\n                        clearInterval(interval);\n                        reject(\"user closed the window\");\n                    }\n                }, 1000);\n            });\n        });\n    }\n}\nexports.WaxEventSource = WaxEventSource;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}