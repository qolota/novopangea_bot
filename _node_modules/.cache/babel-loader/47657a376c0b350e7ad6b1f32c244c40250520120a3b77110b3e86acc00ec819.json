{"ast":null,"code":"import _objectSpread from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _ from'lodash';import{wax,execTransaction}from'../core/wax';import log from'../utils/log';import fetchWaxAccount from'../core/fetchWaxAccount';// novopangea\nimport playGameCalcNextAction from'../novopangea/playGameCalcNextAction';// core \nimport claimWaxRewardCalcNextAction from'../core/claimWaxRewardCalcNextAction';var isBotStarted=false;var GAMES={claimwax:{duration:180*1000,validatorName:'claimwax',calcNextAction:claimWaxRewardCalcNextAction},novopangea:{duration:20*1000,validatorName:'novopangea',calcNextAction:playGameCalcNextAction}};var startGameBot=function startGameBot(_ref){var calcNextAction=_ref.calcNextAction,gameSettings=_ref.gameSettings;gameSettings.interval=setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var durationFromLastExec,signal,account,i;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:durationFromLastExec=Date.now()-gameSettings.lastTime;if(!(durationFromLastExec<5*60*1000&&gameSettings.isInProgress)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:gameSettings.lastTime=Date.now();gameSettings.isInProgress=true;_context.prev=5;_context.next=8;return fetchWaxAccount({accountName:wax.userAccount});case 8:account=_context.sent;if(!(account.cpuLoad>0.98)){_context.next=13;break;}log({project:gameSettings.name,message:\"<cpu_limit> There is no available CPU. CPU usage is \".concat(_.round(account.cpuLoad*100),\"%\"),info:account});gameSettings.isInProgress=false;return _context.abrupt(\"return\");case 13:_context.next=15;return calcNextAction({accountName:wax.userAccount,gameSettings:gameSettings});case 15:signal=_context.sent;log({project:gameSettings.name,message:\"<\".concat(signal.action,\"> \").concat(signal.message),info:signal});if(!signal.isMultipleTransactions){_context.next=27;break;}i=0;case 19:if(!(i<signal.actions.length)){_context.next=25;break;}_context.next=22;return execTransaction({project:gameSettings.name,actions:signal.actions[i]});case 22:i++;_context.next=19;break;case 25:_context.next=29;break;case 27:_context.next=29;return execTransaction({project:gameSettings.name,actions:signal.actions});case 29:_context.next=34;break;case 31:_context.prev=31;_context.t0=_context[\"catch\"](5);log({project:gameSettings.name,message:_context.t0.message,info:_context.t0});case 34:gameSettings.isInProgress=false;case 35:case\"end\":return _context.stop();}},_callee,null,[[5,31]]);})),gameSettings.duration);};var stopGameBot=function stopGameBot(_ref3){var gameSettings=_ref3.gameSettings;clearInterval(gameSettings.interval);gameSettings.interval=null;gameSettings.isInProgress=false;gameSettings.lastTime=Date.now();};export var startBot=function startBot(){if(wax.userAccount==null){console.log('Account is not logged in');return;}if(isBotStarted){console.log('Bot is already started');return;}isBotStarted=true;var allBotSettings=JSON.parse(localStorage.getItem('allBotSettings'));_(GAMES).forEach(function(gameSettings,name){var botSettings=allBotSettings.find(function(botSettigns){return botSettigns.key===gameSettings.validatorName;});if(botSettings==null){console.log(\"Bot \".concat(name,\" doesn't exist\"));return;}if(!botSettings.enabled){console.log(\"Bot \".concat(name,\" turned off\"));return;}console.log(\"Start \".concat(name,\" bot ...\"));startGameBot({calcNextAction:gameSettings.calcNextAction,gameSettings:_objectSpread(_objectSpread({},gameSettings),{},{botParams:botSettings.params,isInProgress:false,interval:null,name:name,lastTime:Date.now()})});});};export var stopBot=function stopBot(){if(!isBotStarted){console.log('Bot is already stopped');return;}isBotStarted=false;_(GAMES).forEach(function(gameSettings,name){console.log(\"Canceled \".concat(name,\" bot\"));stopGameBot({gameSettings:gameSettings});});};","map":{"version":3,"names":["_","wax","execTransaction","log","fetchWaxAccount","playGameCalcNextAction","claimWaxRewardCalcNextAction","isBotStarted","GAMES","claimwax","duration","validatorName","calcNextAction","novopangea","startGameBot","_ref","gameSettings","interval","setInterval","_asyncToGenerator","_regeneratorRuntime","mark","_callee","durationFromLastExec","signal","account","i","wrap","_callee$","_context","prev","next","Date","now","lastTime","isInProgress","abrupt","accountName","userAccount","sent","cpuLoad","project","name","message","concat","round","info","action","isMultipleTransactions","actions","length","t0","stop","stopGameBot","_ref3","clearInterval","startBot","console","allBotSettings","JSON","parse","localStorage","getItem","forEach","botSettings","find","botSettigns","key","enabled","_objectSpread","botParams","params","stopBot"],"sources":["/Users/germangurov/projects/wax_bot/src/bot/bot.js"],"sourcesContent":["import _ from 'lodash';\n\nimport { wax, execTransaction } from '../core/wax';\nimport log from '../utils/log';\nimport fetchWaxAccount from '../core/fetchWaxAccount';\n\n// novopangea\nimport playGameCalcNextAction from '../novopangea/playGameCalcNextAction';\n\n// core \nimport claimWaxRewardCalcNextAction from '../core/claimWaxRewardCalcNextAction';\n\nlet isBotStarted = false;\nconst GAMES = {\n  claimwax: {\n    duration: 180 * 1000,\n    validatorName: 'claimwax',\n    calcNextAction: claimWaxRewardCalcNextAction,\n  },\n\n  novopangea: {\n    duration: 20 * 1000,\n    validatorName: 'novopangea',\n    calcNextAction: playGameCalcNextAction,\n  },\n};\n\nconst startGameBot = ({ calcNextAction, gameSettings }) => {\n  gameSettings.interval = setInterval(async () => {\n    const durationFromLastExec = Date.now() - gameSettings.lastTime;\n    if (durationFromLastExec < 5 * 60 * 1000 && gameSettings.isInProgress) {\n      return;\n    }\n    gameSettings.lastTime = Date.now();\n    gameSettings.isInProgress = true;\n    let signal;\n    try {\n      const account = await fetchWaxAccount({\n        accountName: wax.userAccount,\n      });\n      if (account.cpuLoad > 0.98) {\n        log({\n          project: gameSettings.name,\n          message: `<cpu_limit> There is no available CPU. CPU usage is ${_.round(\n            account.cpuLoad * 100,\n          )}%`,\n          info: account,\n        });\n        gameSettings.isInProgress = false;\n        return;\n      }\n\n      signal = await calcNextAction({\n        accountName: wax.userAccount,\n        gameSettings,\n      });\n      log({\n        project: gameSettings.name,\n        message: `<${signal.action}> ${signal.message}`,\n        info: signal,\n      });\n      if (signal.isMultipleTransactions) {\n        for (let i = 0; i < signal.actions.length; i++) {\n          await execTransaction({\n            project: gameSettings.name,\n            actions: signal.actions[i],\n          });  \n        }\n      } else {\n        await execTransaction({\n          project: gameSettings.name,\n          actions: signal.actions,\n        });\n      }\n    } catch (err) {\n      log({\n        project: gameSettings.name,\n        message: err.message,\n        info: err,\n      });\n    }\n    gameSettings.isInProgress = false;\n  }, gameSettings.duration);\n};\n\nconst stopGameBot = ({ gameSettings }) => {\n  clearInterval(gameSettings.interval);\n  gameSettings.interval = null;\n  gameSettings.isInProgress = false;\n  gameSettings.lastTime = Date.now();\n};\n\nexport const startBot = () => {\n  if (wax.userAccount == null) {\n    console.log('Account is not logged in');\n    return;\n  }\n  if (isBotStarted) {\n    console.log('Bot is already started');\n    return;\n  }\n  isBotStarted = true;\n\n  const allBotSettings = JSON.parse(localStorage.getItem('allBotSettings'));\n\n  _(GAMES)\n    .forEach((gameSettings, name) => {\n      const botSettings = allBotSettings.find(botSettigns => botSettigns.key === gameSettings.validatorName);\n\n      if (botSettings == null) {\n        console.log(`Bot ${name} doesn't exist`);\n        return;\n      }\n      if (!botSettings.enabled) {\n        console.log(`Bot ${name} turned off`);\n        return;\n      }\n    \n      console.log(`Start ${name} bot ...`);\n\n      startGameBot({\n        calcNextAction: gameSettings.calcNextAction,\n        gameSettings: {\n          ...gameSettings,\n          botParams: botSettings.params,\n          isInProgress: false,\n          interval: null,\n          name,\n          lastTime: Date.now(),\n        },\n      });\n    });\n};\n\nexport const stopBot = () => {\n  if (!isBotStarted) {\n    console.log('Bot is already stopped');\n    return;\n  }\n\n  isBotStarted = false;\n\n  _(GAMES)\n    .forEach((gameSettings, name) => {\n      console.log(`Canceled ${name} bot`);\n      stopGameBot({\n        gameSettings,\n      });\n    });\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}