{"ast":null,"code":"const _ = require('lodash');\nconst fetchRealms = require('./fetchRealms');\nconst fetchAllWaxData2 = require('../../core/fetchAllWaxData2');\nconst CONTRACTS = require('../consts/CONTRACTS');\nconst fetchTownhallAccounts = require('./fetchTownhallAccounts');\nconst fetchDistricts = async ({\n  cache = {}\n}) => {\n  const realms = cache.realms || (await fetchRealms());\n  const townhallAccounts = await fetchTownhallAccounts();\n  const districts = await fetchAllWaxData2({\n    params: {\n      code: CONTRACTS.GAME,\n      scope: CONTRACTS.GAME,\n      table: 'districts'\n    },\n    customProcessor: ({\n      row\n    }) => ({\n      id: row.id,\n      realm: realms.find(realm => realm.id === row.realm_id),\n      accounts: _(townhallAccounts).filter(account => account.districtId === row.id).value(),\n      number: row.number,\n      level: row.level,\n      balances: row.balances,\n      taxRate: Number(row.tax_rate)\n    })\n  });\n  return districts;\n};\nmodule.exports = fetchDistricts;","map":{"version":3,"names":["_","require","fetchRealms","fetchAllWaxData2","CONTRACTS","fetchTownhallAccounts","fetchDistricts","cache","realms","townhallAccounts","districts","params","code","GAME","scope","table","customProcessor","row","id","realm","find","realm_id","accounts","filter","account","districtId","value","number","level","balances","taxRate","Number","tax_rate","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/novopangea/api/fetchDistricts.js"],"sourcesContent":["const _ = require('lodash');\nconst fetchRealms = require('./fetchRealms');\nconst fetchAllWaxData2 = require('../../core/fetchAllWaxData2');\nconst CONTRACTS = require('../consts/CONTRACTS');\nconst fetchTownhallAccounts = require('./fetchTownhallAccounts');\n\nconst fetchDistricts = async ({\n    cache = {},\n}) => {\n    const realms = cache.realms || await fetchRealms();\n    const townhallAccounts = await fetchTownhallAccounts();\n    const districts = await fetchAllWaxData2({\n        params: {\n            code: CONTRACTS.GAME,\n            scope: CONTRACTS.GAME,\n            table: 'districts',\n        },\n        customProcessor: ({row}) => ({\n            id: row.id,\n            realm: realms.find(realm => realm.id === row.realm_id),\n            accounts: _(townhallAccounts)\n                .filter(account => account.districtId === row.id)\n                .value(),\n            number: row.number,\n            level: row.level,\n            balances: row.balances,\n            taxRate: Number(row.tax_rate),\n        }),\n    });\n\n    return districts;\n};\n\nmodule.exports = fetchDistricts;"],"mappings":"AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAC3B,MAAMC,WAAW,GAAGD,OAAO,CAAC,eAAe,CAAC;AAC5C,MAAME,gBAAgB,GAAGF,OAAO,CAAC,6BAA6B,CAAC;AAC/D,MAAMG,SAAS,GAAGH,OAAO,CAAC,qBAAqB,CAAC;AAChD,MAAMI,qBAAqB,GAAGJ,OAAO,CAAC,yBAAyB,CAAC;AAEhE,MAAMK,cAAc,GAAG,MAAAA,CAAO;EAC1BC,KAAK,GAAG,CAAC;AACb,CAAC,KAAK;EACF,MAAMC,MAAM,GAAGD,KAAK,CAACC,MAAM,KAAI,MAAMN,WAAW,CAAC,CAAC;EAClD,MAAMO,gBAAgB,GAAG,MAAMJ,qBAAqB,CAAC,CAAC;EACtD,MAAMK,SAAS,GAAG,MAAMP,gBAAgB,CAAC;IACrCQ,MAAM,EAAE;MACJC,IAAI,EAAER,SAAS,CAACS,IAAI;MACpBC,KAAK,EAAEV,SAAS,CAACS,IAAI;MACrBE,KAAK,EAAE;IACX,CAAC;IACDC,eAAe,EAAEA,CAAC;MAACC;IAAG,CAAC,MAAM;MACzBC,EAAE,EAAED,GAAG,CAACC,EAAE;MACVC,KAAK,EAAEX,MAAM,CAACY,IAAI,CAACD,KAAK,IAAIA,KAAK,CAACD,EAAE,KAAKD,GAAG,CAACI,QAAQ,CAAC;MACtDC,QAAQ,EAAEtB,CAAC,CAACS,gBAAgB,CAAC,CACxBc,MAAM,CAACC,OAAO,IAAIA,OAAO,CAACC,UAAU,KAAKR,GAAG,CAACC,EAAE,CAAC,CAChDQ,KAAK,CAAC,CAAC;MACZC,MAAM,EAAEV,GAAG,CAACU,MAAM;MAClBC,KAAK,EAAEX,GAAG,CAACW,KAAK;MAChBC,QAAQ,EAAEZ,GAAG,CAACY,QAAQ;MACtBC,OAAO,EAAEC,MAAM,CAACd,GAAG,CAACe,QAAQ;IAChC,CAAC;EACL,CAAC,CAAC;EAEF,OAAOtB,SAAS;AACpB,CAAC;AAEDuB,MAAM,CAACC,OAAO,GAAG5B,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}