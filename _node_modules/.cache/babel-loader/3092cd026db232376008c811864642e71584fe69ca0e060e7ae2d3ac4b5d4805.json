{"ast":null,"code":"import _toConsumableArray from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _=require('lodash');var fetchWaxData2=require('./fetchWaxData2');var DEFAULT_LIMIT=1000;var fetchAllWaxData2=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref){var params,_ref$customProcessor,customProcessor,_ref$ignoreHttpErrorS,ignoreHttpErrorStatuses,_ref$customLowerBound,customLowerBoundProcessor,lowerBound,rows,data,nextKey,nextRows,processedNextRows,rowIndex,nextRow,processedNextRow;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:params=_ref.params,_ref$customProcessor=_ref.customProcessor,customProcessor=_ref$customProcessor===void 0?/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref3){var row;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:row=_ref3.row;return _context.abrupt(\"return\",row);case 2:case\"end\":return _context.stop();}},_callee);}));return function(_x2){return _ref4.apply(this,arguments);};}():_ref$customProcessor,_ref$ignoreHttpErrorS=_ref.ignoreHttpErrorStatuses,ignoreHttpErrorStatuses=_ref$ignoreHttpErrorS===void 0?[]:_ref$ignoreHttpErrorS,_ref$customLowerBound=_ref.customLowerBoundProcessor,customLowerBoundProcessor=_ref$customLowerBound===void 0?function(_ref5){var lowerBound=_ref5.lowerBound;return lowerBound;}:_ref$customLowerBound;lowerBound=params.lower_bound||null;rows=[];case 3:if(!true){_context2.next=31;break;}console.log(\"Loading wax data \".concat(params.code,\":\").concat(params.table,\" from \").concat(lowerBound,\" +\").concat(DEFAULT_LIMIT));_context2.next=7;return fetchWaxData2({params:_objectSpread({limit:DEFAULT_LIMIT,lower_bound:lowerBound,upper_bound:null,show_payer:false,reverse:false,json:true,key_type:\"\",index_position:1},_.omit(params,['limit','lower_bound','show_payer','reverse','json','key_type','index_position'])),ignoreHttpErrorStatuses:ignoreHttpErrorStatuses});case 7:data=_context2.sent;if(!(data.code=='ignore_http_status')){_context2.next=11;break;}lowerBound=customLowerBoundProcessor({lowerBound:lowerBound});return _context2.abrupt(\"continue\",3);case 11:nextKey=data.nextKey,nextRows=data.rows;if(!(nextRows.length===0)){_context2.next=14;break;}return _context2.abrupt(\"return\",rows);case 14:processedNextRows=[];rowIndex=0;case 16:if(!(rowIndex<nextRows.length)){_context2.next=25;break;}nextRow=nextRows[rowIndex];_context2.next=20;return customProcessor({row:nextRow});case 20:processedNextRow=_context2.sent;processedNextRows.push(processedNextRow);case 22:rowIndex++;_context2.next=16;break;case 25:rows=[].concat(_toConsumableArray(rows),processedNextRows);if(!(nextKey==null)){_context2.next=28;break;}return _context2.abrupt(\"return\",rows);case 28:lowerBound=nextKey;_context2.next=3;break;case 31:case\"end\":return _context2.stop();}},_callee2);}));return function fetchAllWaxData2(_x){return _ref2.apply(this,arguments);};}();module.exports=fetchAllWaxData2;","map":{"version":3,"names":["_","require","fetchWaxData2","DEFAULT_LIMIT","fetchAllWaxData2","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","_ref","params","_ref$customProcessor","customProcessor","_ref$ignoreHttpErrorS","ignoreHttpErrorStatuses","_ref$customLowerBound","customLowerBoundProcessor","lowerBound","rows","data","nextKey","nextRows","processedNextRows","rowIndex","nextRow","processedNextRow","wrap","_callee2$","_context2","prev","next","_ref4","_callee","_ref3","row","_callee$","_context","abrupt","stop","_x2","apply","arguments","_ref5","lower_bound","console","log","concat","code","table","_objectSpread","limit","upper_bound","show_payer","reverse","json","key_type","index_position","omit","sent","length","push","_toConsumableArray","_x","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/core/fetchAllWaxData2.js"],"sourcesContent":["const _ = require('lodash');\nconst fetchWaxData2 = require('./fetchWaxData2');\n\nconst DEFAULT_LIMIT = 1000;\n\nconst fetchAllWaxData2 = async ({\n    params,\n    customProcessor = async ({row}) => row,\n    ignoreHttpErrorStatuses = [],\n    customLowerBoundProcessor = ({lowerBound}) => lowerBound,\n}) => {\n    let lowerBound = params.lower_bound || null;\n    let rows = [];\n\n    while (true) {\n        console.log(`Loading wax data ${params.code}:${params.table} from ${lowerBound} +${DEFAULT_LIMIT}`);\n        const data = await fetchWaxData2({\n            params: {\n                limit: DEFAULT_LIMIT,\n                lower_bound: lowerBound,\n                upper_bound: null,\n                show_payer: false,\n                reverse: false,\n                json: true,\n                key_type: \"\",\n                index_position: 1,\n                ..._.omit(params, [\n                    'limit',\n                    'lower_bound',\n                    'show_payer',\n                    'reverse',\n                    'json',\n                    'key_type',\n                    'index_position',\n                ]),\n            },\n            ignoreHttpErrorStatuses,\n        });\n\n        if (data.code == 'ignore_http_status') {\n            lowerBound = customLowerBoundProcessor({\n                lowerBound,\n            });\n            continue;\n        }\n\n        const {\n            nextKey,\n            rows: nextRows,\n        } = data;\n\n        if (nextRows.length === 0) {\n            return rows;\n        }\n        const processedNextRows = [];\n\n        for (let rowIndex = 0; rowIndex < nextRows.length; rowIndex++) {\n            const nextRow = nextRows[rowIndex];\n            const processedNextRow = await customProcessor({row: nextRow});\n            processedNextRows.push(processedNextRow);\n        }\n        \n        rows = [\n            ...rows,\n            ...processedNextRows,\n        ];\n\n        if (nextKey == null) {\n            return rows;\n        }\n\n        lowerBound = nextKey;\n    }\n};\n\nmodule.exports = fetchAllWaxData2;\n\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}