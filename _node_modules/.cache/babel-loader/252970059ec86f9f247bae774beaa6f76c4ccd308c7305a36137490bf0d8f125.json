{"ast":null,"code":"import _regeneratorRuntime from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/germangurov/projects/wax_bot/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _=require('lodash');var fetchAtomichub=require('../utils/fetchAtomichub');var API_ENDPOINTS=require('../consts/API_ENGPOINTS');var ASSETS_LIMIT=100;var fetchAssets=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref){var params,_ref$customProcessor,customProcessor,page,assets,data,pageAssets;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:params=_ref.params,_ref$customProcessor=_ref.customProcessor,customProcessor=_ref$customProcessor===void 0?function(){}:_ref$customProcessor;page=1;assets=[];case 3:if(!true){_context.next=14;break;}_context.next=6;return fetchAtomichub({type:API_ENDPOINTS.ASSETS,params:_objectSpread({limit:ASSETS_LIMIT,order:'desc',sort:'created',page:page},params)});case 6:data=_context.sent;pageAssets=_(data.data).map(function(asset){return _objectSpread({id:asset.asset_id,mintId:Number(asset.template_mint),owner:asset.owner,schemaName:asset.schema.schema_name,collectionName:asset.collection.collection_name,templateId:asset.template.template_id,isBurned:asset.burned_at_time!=null,name:asset.name},customProcessor({asset:asset}));}).value();assets=[].concat(_toConsumableArray(assets),_toConsumableArray(pageAssets));if(!(pageAssets.length<ASSETS_LIMIT)){_context.next=11;break;}return _context.abrupt(\"break\",14);case 11:page++;_context.next=3;break;case 14:return _context.abrupt(\"return\",assets);case 15:case\"end\":return _context.stop();}},_callee);}));return function fetchAssets(_x){return _ref2.apply(this,arguments);};}();module.exports=fetchAssets;","map":{"version":3,"names":["_","require","fetchAtomichub","API_ENDPOINTS","ASSETS_LIMIT","fetchAssets","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","params","_ref$customProcessor","customProcessor","page","assets","data","pageAssets","wrap","_callee$","_context","prev","next","type","ASSETS","_objectSpread","limit","order","sort","sent","map","asset","id","asset_id","mintId","Number","template_mint","owner","schemaName","schema","schema_name","collectionName","collection","collection_name","templateId","template","template_id","isBurned","burned_at_time","name","value","concat","_toConsumableArray","length","abrupt","stop","_x","apply","arguments","module","exports"],"sources":["/Users/germangurov/projects/wax_bot/src/atomicassets/api/fetchAssets.js"],"sourcesContent":["const _ = require('lodash');\nconst fetchAtomichub = require('../utils/fetchAtomichub');\nconst API_ENDPOINTS = require('../consts/API_ENGPOINTS');\n\nconst ASSETS_LIMIT = 100;\n\nconst fetchAssets = async ({\n    params,\n    customProcessor = () => {},\n}) => {\n  let page = 1;\n  let assets = [];\n\n  while (true) {\n    const data = await fetchAtomichub({\n        type: API_ENDPOINTS.ASSETS,\n        params: {\n            limit: ASSETS_LIMIT,\n            order: 'desc',\n            sort: 'created',\n            page,\n            ...params,\n        },\n    });\n\n    const pageAssets = _(data.data)\n        .map((asset) => {\n\n            return {\n                id: asset.asset_id,\n                mintId: Number(asset.template_mint),\n                owner: asset.owner,\n                schemaName: asset.schema.schema_name,\n                collectionName: asset.collection.collection_name,\n                templateId: asset.template.template_id,\n                isBurned: asset.burned_at_time != null,\n                name: asset.name,\n                ...customProcessor({\n                    asset,\n                }),\n            };\n        })\n        .value();\n\n    assets = [\n        ...assets,\n        ...pageAssets,\n    ];\n    if (pageAssets.length < ASSETS_LIMIT) {\n        break;\n    }\n    page++;\n  }\n\n  return assets;\n};\n\nmodule.exports = fetchAssets;"],"mappings":"2fAAA,GAAM,CAAAA,CAAC,CAAGC,OAAO,CAAC,QAAQ,CAAC,CAC3B,GAAM,CAAAC,cAAc,CAAGD,OAAO,CAAC,yBAAyB,CAAC,CACzD,GAAM,CAAAE,aAAa,CAAGF,OAAO,CAAC,yBAAyB,CAAC,CAExD,GAAM,CAAAG,YAAY,CAAG,GAAG,CAExB,GAAM,CAAAC,WAAW,6BAAAC,KAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAAC,IAAA,MAAAC,MAAA,CAAAC,oBAAA,CAAAC,eAAA,CAAAC,IAAA,CAAAC,MAAA,CAAAC,IAAA,CAAAC,UAAA,QAAAV,mBAAA,GAAAW,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAChBX,MAAM,CAAAD,IAAA,CAANC,MAAM,CAAAC,oBAAA,CAAAF,IAAA,CACNG,eAAe,CAAfA,eAAe,CAAAD,oBAAA,UAAG,UAAM,CAAC,CAAC,CAAAA,oBAAA,CAExBE,IAAI,CAAG,CAAC,CACRC,MAAM,CAAG,EAAE,YAER,IAAI,EAAAK,QAAA,CAAAE,IAAA,WAAAF,QAAA,CAAAE,IAAA,SACU,CAAArB,cAAc,CAAC,CAC9BsB,IAAI,CAAErB,aAAa,CAACsB,MAAM,CAC1Bb,MAAM,CAAAc,aAAA,EACFC,KAAK,CAAEvB,YAAY,CACnBwB,KAAK,CAAE,MAAM,CACbC,IAAI,CAAE,SAAS,CACfd,IAAI,CAAJA,IAAI,EACDH,MAAM,CAEjB,CAAC,CAAC,QATIK,IAAI,CAAAI,QAAA,CAAAS,IAAA,CAWJZ,UAAU,CAAGlB,CAAC,CAACiB,IAAI,CAACA,IAAI,CAAC,CAC1Bc,GAAG,CAAC,SAACC,KAAK,CAAK,CAEZ,OAAAN,aAAA,EACIO,EAAE,CAAED,KAAK,CAACE,QAAQ,CAClBC,MAAM,CAAEC,MAAM,CAACJ,KAAK,CAACK,aAAa,CAAC,CACnCC,KAAK,CAAEN,KAAK,CAACM,KAAK,CAClBC,UAAU,CAAEP,KAAK,CAACQ,MAAM,CAACC,WAAW,CACpCC,cAAc,CAAEV,KAAK,CAACW,UAAU,CAACC,eAAe,CAChDC,UAAU,CAAEb,KAAK,CAACc,QAAQ,CAACC,WAAW,CACtCC,QAAQ,CAAEhB,KAAK,CAACiB,cAAc,EAAI,IAAI,CACtCC,IAAI,CAAElB,KAAK,CAACkB,IAAI,EACbpC,eAAe,CAAC,CACfkB,KAAK,CAALA,KACJ,CAAC,CAAC,EAEV,CAAC,CAAC,CACDmB,KAAK,CAAC,CAAC,CAEZnC,MAAM,IAAAoC,MAAA,CAAAC,kBAAA,CACCrC,MAAM,EAAAqC,kBAAA,CACNnC,UAAU,EAChB,CAAC,KACEA,UAAU,CAACoC,MAAM,CAAGlD,YAAY,GAAAiB,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAkC,MAAA,qBAGpCxC,IAAI,EAAE,CAACM,QAAA,CAAAE,IAAA,wBAAAF,QAAA,CAAAkC,MAAA,UAGFvC,MAAM,2BAAAK,QAAA,CAAAmC,IAAA,MAAA9C,OAAA,GACd,kBAjDK,CAAAL,WAAWA,CAAAoD,EAAA,SAAAnD,KAAA,CAAAoD,KAAA,MAAAC,SAAA,OAiDhB,CAEDC,MAAM,CAACC,OAAO,CAAGxD,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}